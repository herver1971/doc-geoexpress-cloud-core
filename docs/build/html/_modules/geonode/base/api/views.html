

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geonode.base.api.views &mdash; GeoNode Cloud Core 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            GeoNode Cloud Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenido</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">GeoNode Cloud Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../geonode.html">geonode</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">geonode.base</a></li>
      <li class="breadcrumb-item active">geonode.base.api.views</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geonode.base.api.views</h1><div class="highlight"><pre>
<span></span><span class="c1">#########################################################################</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2020 OSGeo</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1">#########################################################################</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">uuid4</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span><span class="p">,</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">URLValidator</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseForbidden</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Subquery</span><span class="p">,</span> <span class="n">QuerySet</span>
<span class="kn">from</span> <span class="nn">django.http.request</span> <span class="kn">import</span> <span class="n">QueryDict</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>

<span class="kn">from</span> <span class="nn">drf_spectacular.utils</span> <span class="kn">import</span> <span class="n">extend_schema</span>
<span class="kn">from</span> <span class="nn">dynamic_rest.viewsets</span> <span class="kn">import</span> <span class="n">DynamicModelViewSet</span><span class="p">,</span> <span class="n">WithDynamicViewSetMixin</span>
<span class="kn">from</span> <span class="nn">dynamic_rest.filters</span> <span class="kn">import</span> <span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span>

<span class="kn">from</span> <span class="nn">oauth2_provider.contrib.rest_framework</span> <span class="kn">import</span> <span class="n">OAuth2Authentication</span>

<span class="kn">from</span> <span class="nn">pinax.ratings.categories</span> <span class="kn">import</span> <span class="n">category_value</span>
<span class="kn">from</span> <span class="nn">pinax.ratings.models</span> <span class="kn">import</span> <span class="n">OverallRating</span><span class="p">,</span> <span class="n">Rating</span>
<span class="kn">from</span> <span class="nn">pinax.ratings.views</span> <span class="kn">import</span> <span class="n">NUM_OF_RATINGS</span>

<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">status</span>
<span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">action</span>
<span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span><span class="p">,</span> <span class="n">MultiPartParser</span>
<span class="kn">from</span> <span class="nn">rest_framework.viewsets</span> <span class="kn">import</span> <span class="n">GenericViewSet</span>
<span class="kn">from</span> <span class="nn">rest_framework.mixins</span> <span class="kn">import</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span>
<span class="kn">from</span> <span class="nn">rest_framework.permissions</span> <span class="kn">import</span> <span class="n">AllowAny</span><span class="p">,</span> <span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">IsAuthenticatedOrReadOnly</span>
<span class="kn">from</span> <span class="nn">rest_framework.authentication</span> <span class="kn">import</span> <span class="n">SessionAuthentication</span><span class="p">,</span> <span class="n">BasicAuthentication</span>

<span class="kn">from</span> <span class="nn">geonode.maps.models</span> <span class="kn">import</span> <span class="n">Map</span>
<span class="kn">from</span> <span class="nn">geonode.layers.models</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">geonode.favorite.models</span> <span class="kn">import</span> <span class="n">Favorite</span>
<span class="kn">from</span> <span class="nn">geonode.base.models</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">ExtraMetadata</span>
<span class="kn">from</span> <span class="nn">geonode.thumbs.exceptions</span> <span class="kn">import</span> <span class="n">ThumbnailError</span>
<span class="kn">from</span> <span class="nn">geonode.thumbs.thumbnails</span> <span class="kn">import</span> <span class="n">create_thumbnail</span>
<span class="kn">from</span> <span class="nn">geonode.thumbs.utils</span> <span class="kn">import</span> <span class="n">_decode_base64</span><span class="p">,</span> <span class="n">BASE64_PATTERN</span>
<span class="kn">from</span> <span class="nn">geonode.groups.conf</span> <span class="kn">import</span> <span class="n">settings</span> <span class="k">as</span> <span class="n">groups_settings</span>
<span class="kn">from</span> <span class="nn">geonode.base.models</span> <span class="kn">import</span> <span class="n">HierarchicalKeyword</span><span class="p">,</span> <span class="n">Region</span><span class="p">,</span> <span class="n">ResourceBase</span><span class="p">,</span> <span class="n">TopicCategory</span><span class="p">,</span> <span class="n">ThesaurusKeyword</span>
<span class="kn">from</span> <span class="nn">geonode.base.api.filters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DynamicSearchFilter</span><span class="p">,</span>
    <span class="n">ExtentFilter</span><span class="p">,</span>
    <span class="n">FacetVisibleResourceFilter</span><span class="p">,</span>
    <span class="n">FavoriteFilter</span><span class="p">,</span>
    <span class="n">TKeywordsFilter</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">geonode.groups.models</span> <span class="kn">import</span> <span class="n">GroupProfile</span><span class="p">,</span> <span class="n">GroupMember</span>
<span class="kn">from</span> <span class="nn">geonode.people.utils</span> <span class="kn">import</span> <span class="n">get_available_users</span>
<span class="kn">from</span> <span class="nn">geonode.security.permissions</span> <span class="kn">import</span> <span class="n">get_compact_perms_list</span><span class="p">,</span> <span class="n">PermSpec</span><span class="p">,</span> <span class="n">PermSpecCompact</span>
<span class="kn">from</span> <span class="nn">geonode.security.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_visible_resources</span><span class="p">,</span>
    <span class="n">get_resources_with_perms</span><span class="p">,</span>
    <span class="n">get_user_visible_groups</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">geonode.resource.models</span> <span class="kn">import</span> <span class="n">ExecutionRequest</span>
<span class="kn">from</span> <span class="nn">geonode.resource.api.tasks</span> <span class="kn">import</span> <span class="n">resouce_service_dispatcher</span>
<span class="kn">from</span> <span class="nn">geonode.resource.manager</span> <span class="kn">import</span> <span class="n">resource_manager</span>

<span class="kn">from</span> <span class="nn">guardian.shortcuts</span> <span class="kn">import</span> <span class="n">get_objects_for_user</span>

<span class="kn">from</span> <span class="nn">.permissions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IsSelfOrAdminOrReadOnly</span><span class="p">,</span>
    <span class="n">IsOwnerOrAdmin</span><span class="p">,</span>
    <span class="n">IsManagerEditOrAdmin</span><span class="p">,</span>
    <span class="n">ResourceBasePermissionsFilter</span><span class="p">,</span>
    <span class="n">UserHasPerms</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.serializers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FavoriteSerializer</span><span class="p">,</span>
    <span class="n">UserSerializer</span><span class="p">,</span>
    <span class="n">PermSpecSerialiazer</span><span class="p">,</span>
    <span class="n">GroupProfileSerializer</span><span class="p">,</span>
    <span class="n">ResourceBaseSerializer</span><span class="p">,</span>
    <span class="n">ResourceBaseTypesSerializer</span><span class="p">,</span>
    <span class="n">OwnerSerializer</span><span class="p">,</span>
    <span class="n">HierarchicalKeywordSerializer</span><span class="p">,</span>
    <span class="n">TopicCategorySerializer</span><span class="p">,</span>
    <span class="n">RegionSerializer</span><span class="p">,</span>
    <span class="n">ThesaurusKeywordSerializer</span><span class="p">,</span>
    <span class="n">ExtraMetadataSerializer</span><span class="p">,</span>
    <span class="n">LinkedResourceSerializer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.pagination</span> <span class="kn">import</span> <span class="n">GeoNodeApiPagination</span>
<span class="kn">from</span> <span class="nn">geonode.base.utils</span> <span class="kn">import</span> <span class="n">validate_extra_metadata</span>

<span class="kn">import</span> <span class="nn">logging</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>



<div class="viewcode-block" id="UserViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">UserViewSet</span><span class="p">(</span><span class="n">DynamicModelViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that allows users to be viewed or edited.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="UserViewSet.authentication_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.authentication_classes">[docs]</a>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SessionAuthentication</span><span class="p">,</span> <span class="n">BasicAuthentication</span><span class="p">,</span> <span class="n">OAuth2Authentication</span><span class="p">]</span></div>

<div class="viewcode-block" id="UserViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">IsAuthenticated</span><span class="p">,</span>
        <span class="n">IsSelfOrAdminOrReadOnly</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="UserViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="UserViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span></div>

<div class="viewcode-block" id="UserViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>


<div class="viewcode-block" id="UserViewSet.get_queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.get_queryset">[docs]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters and sorts users.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">get_available_users</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="c1"># Set up eager loading to avoid N+1 selects</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer_class</span><span class="p">()</span><span class="o">.</span><span class="n">setup_eager_loading</span><span class="p">(</span><span class="n">queryset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the Resources visible to the user.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="UserViewSet.resources">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.resources">[docs]</a>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">permitted</span> <span class="o">=</span> <span class="n">get_objects_for_user</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;base.view_resourcebase&quot;</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">permitted</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>

        <span class="n">resources</span> <span class="o">=</span> <span class="n">get_visible_resources</span><span class="p">(</span>
            <span class="n">qs</span><span class="p">,</span>
            <span class="n">user</span><span class="p">,</span>
            <span class="n">admin_approval_required</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">ADMIN_MODERATE_UPLOADS</span><span class="p">,</span>
            <span class="n">unpublished_not_visible</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">RESOURCE_PUBLISHING</span><span class="p">,</span>
            <span class="n">private_groups_not_visibile</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">GROUP_PRIVATE_RESOURCES</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">paginator</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span><span class="p">()</span>
        <span class="n">paginator</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_size&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">result_page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">result_page</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">({</span><span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">GroupProfileSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the Groups the user is member of.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="UserViewSet.groups">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.UserViewSet.groups">[docs]</a>
    <span class="k">def</span> <span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">qs_ids</span> <span class="o">=</span> <span class="n">GroupMember</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">qs_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">GroupProfileSerializer</span><span class="p">(</span><span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="GroupViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">GroupViewSet</span><span class="p">(</span><span class="n">DynamicModelViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that allows gropus to be viewed or edited.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GroupViewSet.authentication_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.authentication_classes">[docs]</a>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SessionAuthentication</span><span class="p">,</span> <span class="n">BasicAuthentication</span><span class="p">,</span> <span class="n">OAuth2Authentication</span><span class="p">]</span></div>

<div class="viewcode-block" id="GroupViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,</span>
        <span class="n">IsManagerEditOrAdmin</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="GroupViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="GroupViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">GroupProfileSerializer</span></div>

<div class="viewcode-block" id="GroupViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>


<div class="viewcode-block" id="GroupViewSet.get_queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.get_queryset">[docs]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters the public groups and private ones the current user is member of.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">metadata_author_groups</span> <span class="o">=</span> <span class="n">get_user_visible_groups</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">include_public_invite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata_author_groups</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">metadata_author_groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadata_author_groups</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="p">[</span><span class="n">_g</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">_g</span> <span class="ow">in</span> <span class="n">metadata_author_groups</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the Group members.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="GroupViewSet.members">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.members">[docs]</a>
    <span class="k">def</span> <span class="nf">members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">member_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">UserSerializer</span><span class="p">(</span><span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">members</span><span class="p">))</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">UserSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the Group managers.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="GroupViewSet.managers">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.managers">[docs]</a>
    <span class="k">def</span> <span class="nf">managers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">managers</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">get_managers</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">UserSerializer</span><span class="p">(</span><span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">managers</span><span class="p">))</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the Group specific resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="GroupViewSet.resources">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.GroupViewSet.resources">[docs]</a>
    <span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">resources</span><span class="p">()</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span><span class="p">()</span>
        <span class="n">paginator</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_size&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">result_page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">resources</span><span class="p">),</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">result_page</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">({</span><span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">})</span></div>
</div>



<div class="viewcode-block" id="RegionViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">RegionViewSet</span><span class="p">(</span><span class="n">WithDynamicViewSetMixin</span><span class="p">,</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that lists regions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RegionViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllowAny</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="RegionViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">,</span> <span class="n">FacetVisibleResourceFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="RegionViewSet.queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet.queryset">[docs]</a>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Region</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="RegionViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">RegionSerializer</span></div>

<div class="viewcode-block" id="RegionViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.RegionViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>
</div>



<div class="viewcode-block" id="HierarchicalKeywordViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">HierarchicalKeywordViewSet</span><span class="p">(</span><span class="n">WithDynamicViewSetMixin</span><span class="p">,</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that lists hierarchical keywords.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HierarchicalKeywordViewSet.get_queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet.get_queryset">[docs]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resource_keywords</span> <span class="o">=</span> <span class="n">HierarchicalKeyword</span><span class="o">.</span><span class="n">resource_keywords_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_kw_hrefs</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">slugs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">slugs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">))</span>
                <span class="n">_get_kw_hrefs</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="p">[]),</span> <span class="n">slugs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">slugs</span>

        <span class="n">slugs</span> <span class="o">=</span> <span class="n">_get_kw_hrefs</span><span class="p">(</span><span class="n">resource_keywords</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HierarchicalKeyword</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">slug__in</span><span class="o">=</span><span class="n">slugs</span><span class="p">)</span></div>


<div class="viewcode-block" id="HierarchicalKeywordViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllowAny</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="HierarchicalKeywordViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="HierarchicalKeywordViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">HierarchicalKeywordSerializer</span></div>

<div class="viewcode-block" id="HierarchicalKeywordViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.HierarchicalKeywordViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>
</div>



<div class="viewcode-block" id="ThesaurusKeywordViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">ThesaurusKeywordViewSet</span><span class="p">(</span><span class="n">WithDynamicViewSetMixin</span><span class="p">,</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that lists Thesaurus keywords.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ThesaurusKeywordViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllowAny</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="ThesaurusKeywordViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="ThesaurusKeywordViewSet.queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet.queryset">[docs]</a>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">ThesaurusKeyword</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThesaurusKeywordViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ThesaurusKeywordSerializer</span></div>

<div class="viewcode-block" id="ThesaurusKeywordViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ThesaurusKeywordViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>
</div>



<div class="viewcode-block" id="TopicCategoryViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">TopicCategoryViewSet</span><span class="p">(</span><span class="n">WithDynamicViewSetMixin</span><span class="p">,</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that lists categories.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TopicCategoryViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllowAny</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="TopicCategoryViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">,</span> <span class="n">FacetVisibleResourceFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="TopicCategoryViewSet.queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet.queryset">[docs]</a>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">TopicCategory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="TopicCategoryViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">TopicCategorySerializer</span></div>

<div class="viewcode-block" id="TopicCategoryViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.TopicCategoryViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>
</div>



<div class="viewcode-block" id="OwnerViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">OwnerViewSet</span><span class="p">(</span><span class="n">WithDynamicViewSetMixin</span><span class="p">,</span> <span class="n">ListModelMixin</span><span class="p">,</span> <span class="n">RetrieveModelMixin</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that lists all possible owners.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OwnerViewSet.authentication_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.authentication_classes">[docs]</a>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SessionAuthentication</span><span class="p">,</span> <span class="n">BasicAuthentication</span><span class="p">,</span> <span class="n">OAuth2Authentication</span><span class="p">]</span></div>

<div class="viewcode-block" id="OwnerViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">AllowAny</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="OwnerViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span><span class="n">DynamicFilterBackend</span><span class="p">,</span> <span class="n">DynamicSortingFilter</span><span class="p">,</span> <span class="n">DynamicSearchFilter</span><span class="p">]</span></div>

<div class="viewcode-block" id="OwnerViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">OwnerSerializer</span></div>

<div class="viewcode-block" id="OwnerViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>


<div class="viewcode-block" id="OwnerViewSet.get_queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.OwnerViewSet.get_queryset">[docs]</a>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter users with at least one resource</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">queryset</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pk</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filter_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="p">:</span>
            <span class="n">filter_options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;type_filter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span>
                <span class="s2">&quot;title_filter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title__icontains&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">id__in</span><span class="o">=</span><span class="n">Subquery</span><span class="p">(</span><span class="n">get_resources_with_perms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">filter_options</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ResourceBaseViewSet">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet">[docs]</a>
<span class="k">class</span> <span class="nc">ResourceBaseViewSet</span><span class="p">(</span><span class="n">DynamicModelViewSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API endpoint that allows base resources to be viewed or edited.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResourceBaseViewSet.authentication_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.authentication_classes">[docs]</a>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">SessionAuthentication</span><span class="p">,</span> <span class="n">BasicAuthentication</span><span class="p">,</span> <span class="n">OAuth2Authentication</span><span class="p">]</span></div>

<div class="viewcode-block" id="ResourceBaseViewSet.permission_classes">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.permission_classes">[docs]</a>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">]</span></div>

<div class="viewcode-block" id="ResourceBaseViewSet.filter_backends">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.filter_backends">[docs]</a>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TKeywordsFilter</span><span class="p">,</span>
        <span class="n">DynamicFilterBackend</span><span class="p">,</span>
        <span class="n">DynamicSortingFilter</span><span class="p">,</span>
        <span class="n">DynamicSearchFilter</span><span class="p">,</span>
        <span class="n">ExtentFilter</span><span class="p">,</span>
        <span class="n">ResourceBasePermissionsFilter</span><span class="p">,</span>
        <span class="n">FavoriteFilter</span><span class="p">,</span>
    <span class="p">]</span></div>

<div class="viewcode-block" id="ResourceBaseViewSet.queryset">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.queryset">[docs]</a>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-created&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ResourceBaseViewSet.serializer_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.serializer_class">[docs]</a>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ResourceBaseSerializer</span></div>

<div class="viewcode-block" id="ResourceBaseViewSet.pagination_class">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.pagination_class">[docs]</a>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span></div>


<div class="viewcode-block" id="ResourceBaseViewSet._filtered">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet._filtered">[docs]</a>
    <span class="k">def</span> <span class="nf">_filtered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="nb">filter</span><span class="p">):</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span><span class="p">()</span>
        <span class="n">paginator</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_size&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="n">get_resources_with_perms</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="nb">filter</span><span class="p">)</span>
        <span class="n">result_page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">resources</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">result_page</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">({</span><span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the approved Resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="ResourceBaseViewSet.approved">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.approved">[docs]</a>
    <span class="k">def</span> <span class="nf">approved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;is_approved&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the published Resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="ResourceBaseViewSet.published">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.published">[docs]</a>
    <span class="k">def</span> <span class="nf">published</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;is_published&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the featured Resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="ResourceBaseViewSet.featured">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.featured">[docs]</a>
    <span class="k">def</span> <span class="nf">featured</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;featured&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">FavoriteSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the favorite Resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span>
            <span class="n">IsAuthenticated</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.favorites">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.favorites">[docs]</a>
    <span class="k">def</span> <span class="nf">favorites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">paginator</span> <span class="o">=</span> <span class="n">GeoNodeApiPagination</span><span class="p">()</span>
        <span class="n">paginator</span><span class="o">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;page_size&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">favorites</span> <span class="o">=</span> <span class="n">Favorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">favorites_for_user</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">result_page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate_queryset</span><span class="p">(</span><span class="n">favorites</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">FavoriteSerializer</span><span class="p">(</span><span class="n">result_page</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_paginated_response</span><span class="p">({</span><span class="s2">&quot;favorites&quot;</span><span class="p">:</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">FavoriteSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to retrieve the favorite Resources.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">],</span> <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">])</span>
<div class="viewcode-block" id="ResourceBaseViewSet.favorite">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.favorite">[docs]</a>
    <span class="k">def</span> <span class="nf">favorite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Favorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Resource is already in favorites&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Favorite</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="n">Favorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_favorite</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Successfuly added resource to favorites&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Favorite</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Successfuly removed resource from favorites&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Favorite</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Resource not in favorites&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="n">ResourceBaseTypesSerializer</span><span class="p">()},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Returns the list of available ResourceBase polymorphic_ctypes.</span>

<span class="s2">        the mapping looks like:</span>
<span class="s2">        ```</span>
<span class="s2">        {</span>
<span class="s2">            &quot;resource_types&quot;:[</span>
<span class="s2">                {</span>
<span class="s2">                    &quot;name&quot;: &quot;layer&quot;,</span>
<span class="s2">                    &quot;count&quot;: &lt;number of layers&gt;</span>
<span class="s2">                },</span>
<span class="s2">                {</span>
<span class="s2">                    &quot;name&quot;: &quot;map&quot;,</span>
<span class="s2">                    &quot;count&quot;: &lt;number of maps&gt;</span>
<span class="s2">                },</span>
<span class="s2">                {</span>
<span class="s2">                    &quot;name&quot;: &quot;document&quot;,</span>
<span class="s2">                    &quot;count&quot;: &lt;number of documents&gt;</span>
<span class="s2">                },</span>
<span class="s2">                {</span>
<span class="s2">                    &quot;name&quot;: &quot;geostory&quot;,</span>
<span class="s2">                    &quot;count&quot;: &lt;number of geostories&gt;</span>
<span class="s2">                }</span>
<span class="s2">            ]</span>
<span class="s2">        }</span>
<span class="s2">        ```</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_types">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_types">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_to_compact_perms_list</span><span class="p">(</span>
            <span class="n">allowed_perms</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_subtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">compact_perms_labels</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">_compact_perms_list</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">_k</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">allowed_perms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">_is_owner</span> <span class="o">=</span> <span class="n">_k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;anonymous&quot;</span><span class="p">,</span> <span class="n">groups_settings</span><span class="o">.</span><span class="n">REGISTERED_MEMBERS_GROUP_NAME</span><span class="p">]</span>
                <span class="n">_is_none_allowed</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">_is_owner</span>
                <span class="n">_compact_perms_list</span><span class="p">[</span><span class="n">_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_compact_perms_list</span><span class="p">(</span>
                    <span class="n">_v</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_subtype</span><span class="p">,</span> <span class="n">_is_owner</span><span class="p">,</span> <span class="n">_is_none_allowed</span><span class="p">,</span> <span class="n">compact_perms_labels</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">_compact_perms_list</span>

        <span class="n">resource_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_allowed_perms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">_model</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_models</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_model</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ResourceBase&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_m</span> <span class="ow">in</span> <span class="n">_model</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">_m</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">]:</span>
                        <span class="n">_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_m</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                        <span class="n">_allowed_perms</span><span class="p">[</span><span class="n">_m</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">_m</span><span class="o">.</span><span class="n">allowed_permissions</span><span class="p">,</span>
                            <span class="s2">&quot;compact&quot;</span><span class="p">:</span> <span class="n">_to_compact_perms_list</span><span class="p">(</span>
                                <span class="n">_m</span><span class="o">.</span><span class="n">allowed_permissions</span><span class="p">,</span>
                                <span class="n">_m</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                                <span class="n">_m</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                                <span class="n">_m</span><span class="o">.</span><span class="n">compact_permission_labels</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">}</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">GEONODE_APPS_ENABLE</span> <span class="ow">and</span> <span class="s2">&quot;geoapp&quot;</span> <span class="ow">in</span> <span class="n">_types</span><span class="p">:</span>
            <span class="n">_types</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;geoapp&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;CLIENT_APP_LIST&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_APP_LIST</span><span class="p">:</span>
                <span class="n">_types</span> <span class="o">+=</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_APP_LIST</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">geonode.geoapps.models</span> <span class="kn">import</span> <span class="n">GeoApp</span>

                <span class="n">geoapp_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">GeoApp</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;resource_type&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">distinct</span><span class="p">()]</span>
                <span class="n">_types</span> <span class="o">+=</span> <span class="n">geoapp_types</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;CLIENT_APP_ALLOWED_PERMS_LIST&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_APP_ALLOWED_PERMS_LIST</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_type</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_APP_ALLOWED_PERMS_LIST</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">_type_name</span><span class="p">,</span> <span class="n">_type_perms</span> <span class="ow">in</span> <span class="n">_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">_compact_permission_labels</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s2">&quot;CLIENT_APP_COMPACT_PERM_LABELS&quot;</span><span class="p">):</span>
                            <span class="n">_compact_permission_labels</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_APP_COMPACT_PERM_LABELS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_type_name</span><span class="p">,</span> <span class="p">{})</span>
                        <span class="n">_allowed_perms</span><span class="p">[</span><span class="n">_type_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">_type_perms</span><span class="p">,</span>
                            <span class="s2">&quot;compact&quot;</span><span class="p">:</span> <span class="n">_to_compact_perms_list</span><span class="p">(</span>
                                <span class="n">_type_perms</span><span class="p">,</span> <span class="n">_type_name</span><span class="p">,</span> <span class="n">_type_name</span><span class="p">,</span> <span class="n">_compact_permission_labels</span>
                            <span class="p">),</span>
                        <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">geonode.geoapps.models</span> <span class="kn">import</span> <span class="n">GeoApp</span>

                <span class="k">for</span> <span class="n">_m</span> <span class="ow">in</span> <span class="n">GeoApp</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type__in</span><span class="o">=</span><span class="n">_types</span><span class="p">)</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_m</span><span class="p">,</span> <span class="s2">&quot;resource_type&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_m</span><span class="o">.</span><span class="n">resource_type</span> <span class="ow">and</span> <span class="n">_m</span><span class="o">.</span><span class="n">resource_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_allowed_perms</span><span class="p">:</span>
                        <span class="n">_allowed_perms</span><span class="p">[</span><span class="n">_m</span><span class="o">.</span><span class="n">resource_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">_m</span><span class="o">.</span><span class="n">allowed_permissions</span><span class="p">,</span>
                            <span class="s2">&quot;compact&quot;</span><span class="p">:</span> <span class="n">_to_compact_perms_list</span><span class="p">(</span>
                                <span class="n">_m</span><span class="o">.</span><span class="n">allowed_permissions</span><span class="p">,</span> <span class="n">_m</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">_m</span><span class="o">.</span><span class="n">subtype</span><span class="p">,</span> <span class="n">_m</span><span class="o">.</span><span class="n">compact_permission_labels</span>
                            <span class="p">),</span>
                        <span class="p">}</span>

        <span class="k">for</span> <span class="n">_type</span> <span class="ow">in</span> <span class="n">_types</span><span class="p">:</span>
            <span class="n">resource_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">_type</span><span class="p">,</span>
                    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">get_resources_with_perms</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type</span><span class="o">=</span><span class="n">_type</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
                    <span class="s2">&quot;allowed_perms&quot;</span><span class="p">:</span> <span class="n">_allowed_perms</span><span class="p">[</span><span class="n">_type</span><span class="p">]</span> <span class="k">if</span> <span class="n">_type</span> <span class="ow">in</span> <span class="n">_allowed_perms</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;resource_types&quot;</span><span class="p">:</span> <span class="n">resource_types</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">],</span>
        <span class="n">request</span><span class="o">=</span><span class="n">PermSpecSerialiazer</span><span class="p">(),</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Sets an object&#39;s the permission levels based on the perm_spec JSON.</span>

<span class="s2">        the mapping looks like:</span>
<span class="s2">        ```</span>
<span class="s2">        {</span>
<span class="s2">            &#39;users&#39;: {</span>
<span class="s2">                &#39;AnonymousUser&#39;: [&#39;view&#39;],</span>
<span class="s2">                &lt;username&gt;: [&#39;perm1&#39;,&#39;perm2&#39;,&#39;perm3&#39;],</span>
<span class="s2">                &lt;username2&gt;: [&#39;perm1&#39;,&#39;perm2&#39;,&#39;perm3&#39;]</span>
<span class="s2">                ...</span>
<span class="s2">            },</span>
<span class="s2">            &#39;groups&#39;: {</span>
<span class="s2">                &lt;groupname&gt;: [&#39;perm1&#39;,&#39;perm2&#39;,&#39;perm3&#39;],</span>
<span class="s2">                &lt;groupname2&gt;: [&#39;perm1&#39;,&#39;perm2&#39;,&#39;perm3&#39;],</span>
<span class="s2">                ...</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">        ```</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;perms-spec&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_permissions">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_permissions">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instructs the Async dispatcher to execute a &#39;DELETE&#39; or &#39;UPDATE&#39; on the permissions of a valid &#39;uuid&#39;</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            - GET input_params: {</span>
<span class="sd">                id: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">            - DELETE input_params: {</span>
<span class="sd">                id: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">            - PUT input_params: {</span>
<span class="sd">                id: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">                owner: str = None</span>
<span class="sd">                permissions: dict = {}</span>
<span class="sd">                created: bool = False</span>
<span class="sd">            }</span>

<span class="sd">            - output_params: {</span>
<span class="sd">                output: {</span>
<span class="sd">                    uuid: &quot;&lt;str: UUID&gt;&quot;</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            - output: {</span>
<span class="sd">                    &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                    &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                    &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">                }</span>

<span class="sd">        Sample Requests:</span>

<span class="sd">        - Removes all the permissions (except owner and admin ones) from a Resource:</span>

<span class="sd">            .. code-block:: bash</span>

<span class="sd">                curl -v -X DELETE -u admin:admin -H &quot;Content-Type: application/json&quot; http://localhost:8000/api/v2/resources/&lt;id&gt;/permissions</span>

<span class="sd">        - Changes the owner of a Resource:</span>

<span class="sd">            .. code-block:: bash</span>

<span class="sd">                curl -u admin:admin --location --request PUT &#39;http://localhost:8000/api/v2/resources/&lt;id&gt;/permissions&#39; \\</span>
<span class="sd">                    --header &#39;Content-Type: application/json&#39; \\</span>
<span class="sd">                    --data-raw &#39;{&quot;groups&quot;: [],&quot;organizations&quot;: [],&quot;users&quot;: [{&quot;id&quot;: 1001,&quot;permissions&quot;: &quot;owner&quot;}]}&#39;</span>

<span class="sd">        - Assigns View permissions to some users:</span>

<span class="sd">            .. code-block:: bash</span>

<span class="sd">                curl -u admin:admin --location --request PUT &#39;http://localhost:8000/api/v2/resources/&lt;id&gt;/permissions&#39; \\</span>
<span class="sd">                    --header &#39;Content-Type: application/json&#39; \\</span>
<span class="sd">                    --data-raw &#39;{&quot;groups&quot;: [],&quot;organizations&quot;: [],&quot;users&quot;: [{&quot;id&quot;: 1000,&quot;permissions&quot;: &quot;view&quot;}]}&#39;</span>

<span class="sd">        - Assigns View permissions to anyone:</span>

<span class="sd">            .. code-block:: bash</span>

<span class="sd">                curl -u admin:admin --location --request PUT &#39;http://localhost:8000/api/v2/resources/&lt;id&gt;/permissions&#39; \\</span>
<span class="sd">                    --header &#39;Content-Type: application/json&#39; \\</span>
<span class="sd">                    --data-raw &#39;{&quot;groups&quot;: [],&quot;organizations&quot;: [],&quot;users&quot;: [{&quot;id&quot;: -1,&quot;permissions&quot;: &quot;view&quot;}]}&#39;</span>

<span class="sd">        - Assigns View permissions to anyone and edit permissions to a Group on a Dataset:</span>

<span class="sd">            .. code-block:: bash</span>

<span class="sd">                curl -u admin:admin --location --request PUT &#39;http://localhost:8000/api/v2/resources/&lt;id&gt;/permissions&#39; \\</span>
<span class="sd">                    --header &#39;Content-Type: application/json&#39; \\</span>
<span class="sd">                    --data-raw &#39;{&quot;groups&quot;: [{&quot;id&quot;: 1,&quot;permissions&quot;: &quot;manage&quot;}],&quot;organizations&quot;: [],&quot;users&quot;: [{&quot;id&quot;: -1,&quot;permissions&quot;: &quot;view&quot;}]}&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">_user_can_manage</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;change_resourcebase_permissions&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_self_resource</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">_user_can_manage</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perms_spec</span> <span class="o">=</span> <span class="n">PermSpec</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get_all_level_info</span><span class="p">(),</span> <span class="n">resource</span><span class="p">)</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">perms_spec</span><span class="o">.</span><span class="n">compact</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
                <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;remove_permissions&quot;</span><span class="p">,</span>
                    <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span>
                    <span class="n">input_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">)},</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
                <span class="n">perms_spec_compact</span> <span class="o">=</span> <span class="n">PermSpecCompact</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
                <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;set_permissions&quot;</span><span class="p">,</span>
                    <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span>
                    <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">),</span>
                        <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
                        <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="n">perms_spec_compact</span><span class="o">.</span><span class="n">extended</span><span class="p">,</span>
                        <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PATCH&quot;</span><span class="p">:</span>
                <span class="n">perms_spec_compact_patch</span> <span class="o">=</span> <span class="n">PermSpecCompact</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
                <span class="n">perms_spec_compact_resource</span> <span class="o">=</span> <span class="n">PermSpecCompact</span><span class="p">(</span><span class="n">perms_spec</span><span class="o">.</span><span class="n">compact</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
                <span class="n">perms_spec_compact_resource</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">perms_spec_compact_patch</span><span class="p">)</span>
                <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                    <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;set_permissions&quot;</span><span class="p">,</span>
                    <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;permissions&quot;</span><span class="p">,</span>
                    <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">),</span>
                        <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
                        <span class="s2">&quot;permissions&quot;</span><span class="p">:</span> <span class="n">perms_spec_compact_resource</span><span class="o">.</span><span class="n">extended</span><span class="p">,</span>
                        <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                    <span class="p">},</span>
                <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to set the thumbnail url for an existing dataset.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;(?P&lt;resource_id&gt;\d+)/set_thumbnail_from_bbox&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;set-thumb-from-bbox&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">(</span><span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">]}})],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.set_thumbnail_from_bbox">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.set_thumbnail_from_bbox">[docs]</a>
    <span class="k">def</span> <span class="nf">set_thumbnail_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">traceback</span>
        <span class="kn">from</span> <span class="nn">django.utils.datastructures</span> <span class="kn">import</span> <span class="n">MultiValueDictKeyError</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">resource_id</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get_real_instance</span><span class="p">(),</span> <span class="p">(</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">Map</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Not implemented: Endpoint available only for Dataset and Maps&quot;</span><span class="p">)</span>

            <span class="n">request_body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span> <span class="k">else</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">request_body</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">request_body</span><span class="p">[</span><span class="s2">&quot;srid&quot;</span><span class="p">]]</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="n">request_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zoom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">MultiValueDictKeyError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">_k</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">request_body</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">request_body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">_k</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="n">request_body</span><span class="p">[</span><span class="s2">&quot;bbox&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">request_body</span><span class="p">[</span><span class="s2">&quot;srid&quot;</span><span class="p">]]</span>
                <span class="n">zoom</span> <span class="o">=</span> <span class="n">request_body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zoom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">thumbnail_url</span> <span class="o">=</span> <span class="n">create_thumbnail</span><span class="p">(</span>
                <span class="n">resource</span><span class="o">.</span><span class="n">get_real_instance</span><span class="p">(),</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">background_zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Thumbnail correctly created.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;thumbnail_url&quot;</span><span class="p">:</span> <span class="n">thumbnail_url</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">200</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resource selected with id </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2"> does not exists&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Resource selected with id </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2"> does not exists&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span>
                <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">405</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ThumbnailError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span> <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Instructs the Async dispatcher to execute a &#39;INGEST&#39; operation.&quot;</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;ingest/(?P&lt;resource_type&gt;\w+)&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;resource-service-ingest&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_ingest">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_ingest">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_ingest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instructs the Async dispatcher to execute an &#39;INGEST&#39; operation.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            &#39;owner&#39; is mandatory in the `defaults` field.</span>

<span class="sd">        - **POST input_params**:</span>
<span class="sd">            - `uuid`: &quot;&lt;str: UUID&gt;&quot;</span>
<span class="sd">            - `files`: &quot;&lt;list(str) path&gt;&quot;</span>
<span class="sd">            - `defaults`: &quot;{\&quot;owner\&quot;:\&quot;&lt;str: username&gt;\&quot;,&lt;list: str&gt;}&quot;</span>
<span class="sd">            - `resource_type`: &quot;&lt;enum: [&#39;dataset&#39;, &#39;document&#39;, &#39;map&#39;, &#39;&lt;GeoApp: name&gt;&#39;]&gt;&quot;</span>

<span class="sd">        - **output_params**:</span>
<span class="sd">            - `output`: &lt;int: number of resources deleted / 0 if none&gt;</span>

<span class="sd">        - **output**:</span>

<span class="sd">         .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">        **Sample Request**:</span>

<span class="sd">        1. **POST**:</span>

<span class="sd">         .. code-block:: bash</span>

<span class="sd">            curl -v -X POST -u admin:admin -H &quot;Content-Type: application/json&quot; \\</span>
<span class="sd">                -d &#39;defaults={&quot;owner&quot;:&quot;admin&quot;,&quot;title&quot;:&quot;pippo&quot;}&#39; \\</span>
<span class="sd">                -d &#39;files=[&quot;/mnt/c/Data/flowers.jpg&quot;]&#39; \\</span>
<span class="sd">                http://localhost:8000/api/v2/resources/ingest/document</span>

<span class="sd">        **Response**:</span>

<span class="sd">         .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;90ca670d-df60-44b6-b358-d792c6aecc58&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/90ca670d-df60-44b6-b358-d792c6aecc58&quot;</span>
<span class="sd">            }</span>

<span class="sd">        2. **GET**:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X GET -u admin:admin http://localhost:8000/api/v2/resource-service/execution-status/90ca670d-df60-44b6-b358-d792c6aecc58</span>

<span class="sd">        **Response**:</span>

<span class="sd">         .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;user&quot;: &quot;admin&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;finished&quot;,</span>
<span class="sd">                &quot;func_name&quot;: &quot;create&quot;,</span>
<span class="sd">                &quot;created&quot;: &quot;2021-07-22T15:32:09.096075Z&quot;,</span>
<span class="sd">                &quot;finished&quot;: &quot;2021-07-22T15:32:26.936683Z&quot;,</span>
<span class="sd">                &quot;last_updated&quot;: &quot;2021-07-22T15:32:09.096129Z&quot;,</span>
<span class="sd">                &quot;input_params&quot;: {</span>
<span class="sd">                    &quot;uuid&quot;: &quot;fa404f64-eb01-11eb-8f91-00155d41f2fb&quot;,</span>
<span class="sd">                    &quot;files&quot;: &quot;[\&quot;/mnt/c/Data/flowers.jpg\&quot;]&quot;,</span>
<span class="sd">                    &quot;defaults&quot;: &quot;{\&quot;owner\&quot;:\&quot;admin\&quot;,\&quot;title\&quot;:\&quot;pippo\&quot;}&quot;,</span>
<span class="sd">                    &quot;resource_type&quot;: &quot;dataset&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &quot;output_params&quot;: {</span>
<span class="sd">                    &quot;output&quot;: {</span>
<span class="sd">                        &quot;uuid&quot;: &quot;fa404f64-eb01-11eb-8f91-00155d41f2fb&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request_params</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
            <span class="n">resource_filter</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">)</span>
            <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;ingest&quot;</span><span class="p">,</span>
                <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource_filter</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">if</span> <span class="n">resource_filter</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;ingest&quot;</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
                    <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">resource_type</span><span class="p">,</span>
                    <span class="s2">&quot;defaults&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaults&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;owner&quot;:&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span> <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Instructs the Async dispatcher to execute a &#39;CREATE&#39; operation.&quot;</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;create/(?P&lt;resource_type&gt;\w+)&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;resource-service-create&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">(</span><span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">]}})],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_create">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_create">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instructs the Async dispatcher to execute a &#39;CREATE&#39; operation.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            This will create an empty dataset; if you need to upload a resource to GeoNode,</span>
<span class="sd">            consider using the endpoint &quot;ingest&quot; instead.</span>

<span class="sd">        - **POST input_params**:</span>

<span class="sd">        :param uuid: &lt;str: UUID&gt;</span>
<span class="sd">        :param defaults: {\&quot;owner\&quot;:\&quot;&lt;str: username&gt;\&quot;,&lt;list: str&gt;}</span>
<span class="sd">        :param resource_type: &lt;enum: [&#39;dataset&#39;, &#39;document&#39;, &#39;map&#39;, &#39;&lt;GeoApp: name&gt;&#39;]&gt;</span>

<span class="sd">        .. note:: &#39;owner&#39; is mandatory</span>

<span class="sd">        - **output_params**:</span>

<span class="sd">        :param output: &lt;int: number of resources deleted / 0 if none&gt;</span>

<span class="sd">        - **output**:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">        **Sample Request**:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            1. curl -v -X POST -u admin:admin -H &quot;Content-Type: application/json&quot; \\</span>
<span class="sd">                -d &#39;defaults={&quot;owner&quot;:&quot;admin&quot;,&quot;title&quot;:&quot;pippo&quot;}&#39; \\</span>
<span class="sd">                http://localhost:8000/api/v2/resources/create/dataset</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;90ca670d-df60-44b6-b358-d792c6aecc58&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/90ca670d-df60-44b6-b358-d792c6aecc58&quot;</span>
<span class="sd">            }</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            2. curl -v -X GET -u admin:admin \\</span>
<span class="sd">                http://localhost:8000/api/v2/resource-service/execution-status/90ca670d-df60-44b6-b358-d792c6aecc58</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;user&quot;: &quot;admin&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;finished&quot;,</span>
<span class="sd">                &quot;func_name&quot;: &quot;create&quot;,</span>
<span class="sd">                &quot;created&quot;: &quot;2021-07-22T15:32:09.096075Z&quot;,</span>
<span class="sd">                &quot;finished&quot;: &quot;2021-07-22T15:32:26.936683Z&quot;,</span>
<span class="sd">                &quot;last_updated&quot;: &quot;2021-07-22T15:32:09.096129Z&quot;,</span>
<span class="sd">                &quot;input_params&quot;: {</span>
<span class="sd">                    &quot;uuid&quot;: &quot;fa404f64-eb01-11eb-8f91-00155d41f2fb&quot;,</span>
<span class="sd">                    &quot;defaults&quot;: &quot;{\&quot;owner\&quot;:\&quot;admin\&quot;,\&quot;title\&quot;:\&quot;pippo\&quot;}&quot;,</span>
<span class="sd">                    &quot;resource_type&quot;: &quot;dataset&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &quot;output_params&quot;: {</span>
<span class="sd">                    &quot;output&quot;: {</span>
<span class="sd">                        &quot;uuid&quot;: &quot;fa404f64-eb01-11eb-8f91-00155d41f2fb&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request_params</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>
            <span class="n">resource_filter</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="n">uuid</span><span class="p">)</span>

            <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="p">,</span>
                <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource_filter</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">if</span> <span class="n">resource_filter</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
                    <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">resource_type</span><span class="p">,</span>
                    <span class="s2">&quot;defaults&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaults&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;owner&quot;:&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Instructs the Async dispatcher to execute a &#39;DELETE&#39; operation over a valid &#39;uuid&#39;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;resource-service-delete&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;delete&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_delete">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_delete">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instructs the Async dispatcher to execute a &#39;DELETE&#39; operation over a valid &#39;uuid&#39;</span>

<span class="sd">        - DELETE</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            -input_params: {</span>
<span class="sd">                id: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">            - output_params: {</span>
<span class="sd">                output: &lt;int: number of resources deleted / 0 if none&gt;</span>
<span class="sd">            }</span>

<span class="sd">            - output: {</span>
<span class="sd">                    &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                    &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                    &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">                }</span>

<span class="sd">        Sample request:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X DELETE -u admin:admin http://localhost:8000/api/v2/resources/&lt;id&gt;/delete</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;:&quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;:&quot;7ed0b141-cf85-434f-bbfb-c02447a5221b&quot;,</span>
<span class="sd">                &quot;status_url&quot;:&quot;http://localhost:8000/api/v2/resource-service/execution-status/7ed0b141-cf85-434f-bbfb-c02447a5221b&quot;</span>
<span class="sd">            }</span>


<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X GET -u admin:admin http://localhost:8000/api/v2/resource-service/execution-status/7ed0b141-cf85-434f-bbfb-c02447a5221b</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;user&quot;:&quot;admin&quot;,</span>
<span class="sd">                &quot;status&quot;:&quot;finished&quot;,</span>
<span class="sd">                &quot;func_name&quot;:&quot;delete&quot;,</span>
<span class="sd">                &quot;created&quot;:&quot;2021-07-19T14:09:59.930619Z&quot;,</span>
<span class="sd">                &quot;finished&quot;:&quot;2021-07-19T14:10:00.054915Z&quot;,</span>
<span class="sd">                &quot;last_updated&quot;:&quot;2021-07-19T14:09:59.930647Z&quot;,</span>
<span class="sd">                &quot;input_params&quot;:{&quot;uuid&quot;:&quot;1234&quot;},</span>
<span class="sd">                &quot;output_params&quot;:{&quot;output&quot;:0}</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;delete_resourcebase&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_self_resource</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span>
                <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Instructs the Async dispatcher to execute a &#39;UPDATE&#39; operation over a valid &#39;uuid&#39;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;resource-service-update&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_update">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_update">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instructs the Async dispatcher to execute a &#39;UPDATE&#39; operation over a valid &#39;uuid&#39;</span>

<span class="sd">        - PUT</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">           - input_params: {</span>
<span class="sd">                id: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">                xml_file: str = None</span>
<span class="sd">                metadata_uploaded: bool = False</span>
<span class="sd">                vals: dict = {}</span>
<span class="sd">                regions: list = []</span>
<span class="sd">                keywords: list = []</span>
<span class="sd">                custom: dict = {}</span>
<span class="sd">                notify: bool = True</span>
<span class="sd">            }</span>

<span class="sd">            - output_params: {</span>
<span class="sd">                output: {</span>
<span class="sd">                    uuid: &quot;&lt;str: UUID&gt;&quot;</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        - output:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">        Sample Request:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X PUT -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;vals={&quot;title&quot;:&quot;pippo&quot;}&#39; http://localhost:8000/api/v2/resources/&lt;id&gt;/update</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;:&quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;:&quot;08846e84-eae4-11eb-84be-00155d41f2fb&quot;,</span>
<span class="sd">                &quot;status_url&quot;:&quot;http://localhost:8000/api/v2/resource-service/execution-status/08846e84-eae4-11eb-84be-00155d41f2fb&quot;</span>
<span class="sd">            }</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X GET -u admin:admin http://localhost:8000/api/v2/resource-service/execution-status/08846e84-eae4-11eb-84be-00155d41f2fb</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;user&quot;: &quot;admin&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;finished&quot;,</span>
<span class="sd">                &quot;func_name&quot;: &quot;update&quot;,</span>
<span class="sd">                &quot;created&quot;: &quot;2021-07-22T14:42:56.284740Z&quot;,</span>
<span class="sd">                &quot;finished&quot;: &quot;2021-07-22T14:43:01.813971Z&quot;,</span>
<span class="sd">                &quot;last_updated&quot;: &quot;2021-07-22T14:42:56.284797Z&quot;,</span>
<span class="sd">                &quot;input_params&quot;: {</span>
<span class="sd">                    &quot;uuid&quot;: &quot;ee11541c-eaee-11eb-942c-00155d41f2fb&quot;,</span>
<span class="sd">                    &quot;vals&quot;: &quot;{\&quot;title\&quot;:\&quot;pippo\&quot;}&quot;,</span>
<span class="sd">                    &quot;custom&quot;: {},</span>
<span class="sd">                    &quot;notify&quot;: true,</span>
<span class="sd">                    &quot;regions&quot;: [],</span>
<span class="sd">                    &quot;keywords&quot;: [],</span>
<span class="sd">                    &quot;xml_file&quot;: null,</span>
<span class="sd">                    &quot;metadata_uploaded&quot;: false</span>
<span class="sd">                },</span>
<span class="sd">                &quot;output_params&quot;: {</span>
<span class="sd">                    &quot;output&quot;: {</span>
<span class="sd">                        &quot;uuid&quot;: &quot;ee11541c-eaee-11eb-942c-00155d41f2fb&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Sample Request with more parameters:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X PUT -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;vals={&quot;title&quot;:&quot;pippo&quot;}&#39; -d &#39;metadata_uploaded=true&#39; -d &#39;keywords=[&quot;k1&quot;, &quot;k2&quot;, &quot;k3&quot;]&#39;</span>

<span class="sd">        http://localhost:8000/api/v2/resources/&lt;id&gt;/update</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;change_resourcebase&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_self_resource</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request_params</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
            <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">),</span>
                    <span class="s2">&quot;xml_file&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xml_file&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="s2">&quot;metadata_uploaded&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata_uploaded&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
                    <span class="s2">&quot;vals&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vals&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;regions&quot;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;custom&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;notify&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;notify&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Instructs the Async dispatcher to execute a &#39;COPY&#39; operation over a valid &#39;uuid&#39;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;resource-service-copy&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span>
            <span class="n">IsAuthenticated</span><span class="p">,</span>
            <span class="n">UserHasPerms</span><span class="p">(</span>
                <span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;PUT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">,</span> <span class="s2">&quot;base.download_resourcebase&quot;</span><span class="p">],</span> <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="nb">all</span><span class="p">},</span>
                    <span class="s2">&quot;document&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;PUT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">,</span> <span class="s2">&quot;base.download_resourcebase&quot;</span><span class="p">],</span> <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="nb">all</span><span class="p">},</span>
                    <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;PUT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">]},</span>
                <span class="p">}</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.resource_service_copy">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.resource_service_copy">[docs]</a>
    <span class="k">def</span> <span class="nf">resource_service_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instructs the Async dispatcher to execute a &#39;COPY&#39; operation over a valid &#39;pk&#39;</span>

<span class="sd">        PUT</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            input_params: {</span>
<span class="sd">                instance: &quot;&lt;str: ID&gt;&quot;</span>
<span class="sd">                owner: &quot;&lt;str: username = &lt;current_user&gt;&gt;&quot;</span>
<span class="sd">                defaults: dict = {}</span>
<span class="sd">            }</span>

<span class="sd">            - output_params: {</span>
<span class="sd">                output: {</span>
<span class="sd">                    uuid: &quot;&lt;str: UUID&gt;&quot;</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        output:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;: &quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;: &quot;&lt;str: execution ID&gt;&quot;,</span>
<span class="sd">                &quot;status_url&quot;: &quot;http://localhost:8000/api/v2/resource-service/execution-status/&lt;str: execution ID&gt;&quot;</span>
<span class="sd">            }</span>

<span class="sd">        Sample Request:</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X PUT -u admin:admin -H &quot;Content-Type: application/json&quot; -d &#39;defaults={&quot;title&quot;:&quot;pippo&quot;}&#39; http://localhost:8000/api/v2/resources/&lt;id&gt;/copy</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: json</span>

<span class="sd">            {</span>
<span class="sd">                &quot;status&quot;:&quot;ready&quot;,</span>
<span class="sd">                &quot;execution_id&quot;:&quot;08846e84-eae4-11eb-84be-00155d41f2fb&quot;,</span>
<span class="sd">                &quot;status_url&quot;:&quot;http://localhost:8000/api/v2/resource-service/execution-status/08846e84-eae4-11eb-84be-00155d41f2fb&quot;</span>
<span class="sd">            }</span>

<span class="sd">        .. code-block:: bash</span>

<span class="sd">            curl -v -X GET -u admin:admin http://localhost:8000/api/v2/resource-service/execution-status/08846e84-eae4-11eb-84be-00155d41f2fb</span>
<span class="sd">        OUTPUT:</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            {</span>
<span class="sd">                &quot;user&quot;: &quot;admin&quot;,</span>
<span class="sd">                &quot;status&quot;: &quot;finished&quot;,</span>
<span class="sd">                &quot;func_name&quot;: &quot;update&quot;,</span>
<span class="sd">                &quot;created&quot;: &quot;2021-07-22T14:42:56.284740Z&quot;,</span>
<span class="sd">                &quot;finished&quot;: &quot;2021-07-22T14:43:01.813971Z&quot;,</span>
<span class="sd">                &quot;last_updated&quot;: &quot;2021-07-22T14:42:56.284797Z&quot;,</span>
<span class="sd">                &quot;input_params&quot;: {</span>
<span class="sd">                    &quot;uuid&quot;: &quot;ee11541c-eaee-11eb-942c-00155d41f2fb&quot;,</span>
<span class="sd">                    &quot;defaults&quot;: &quot;{\&quot;title\&quot;:\&quot;pippo\&quot;}&quot;</span>
<span class="sd">                },</span>
<span class="sd">                &quot;output_params&quot;: {</span>
<span class="sd">                    &quot;output&quot;: {</span>
<span class="sd">                        &quot;uuid&quot;: &quot;ee11541c-eaee-11eb-942c-00155d41f2fb&quot;</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">config</span><span class="o">.</span><span class="n">read_only</span>
            <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">maintenance</span>
            <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span>
            <span class="ow">or</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;view_resourcebase&quot;</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_self_resource</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="o">.</span><span class="n">is_copyable</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Resource can not be cloned.&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_request_params</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">_exec_request</span> <span class="o">=</span> <span class="n">ExecutionRequest</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
                <span class="n">func_name</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>
                <span class="n">geonode_resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span>
                <span class="n">input_params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;instance&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
                    <span class="s2">&quot;defaults&quot;</span><span class="p">:</span> <span class="n">request_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaults&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>
            <span class="n">resouce_service_dispatcher</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,),</span> <span class="n">expiration</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">,</span>
                    <span class="s2">&quot;status_url&quot;</span><span class="p">:</span> <span class="n">urljoin</span><span class="p">(</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;rs-execution-status&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">_exec_request</span><span class="o">.</span><span class="n">exec_id</span><span class="p">})</span>
                    <span class="p">),</span>
                <span class="p">},</span>
                <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to rate and get overall rating of the Resource.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;ratings&quot;</span><span class="p">,</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;ratings&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span>
            <span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,</span>
            <span class="n">UserHasPerms</span><span class="p">(</span><span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">]}}),</span>
        <span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.ratings">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.ratings">[docs]</a>
    <span class="k">def</span> <span class="nf">ratings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">get_real_instance</span><span class="p">()</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="n">rating_input</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;rating&quot;</span><span class="p">))</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="c1"># check if category is configured in settings.PINAX_RATINGS_CATEGORY_CHOICES</span>
            <span class="n">cat_choice</span> <span class="o">=</span> <span class="n">category_value</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>

            <span class="c1"># Check for errors and bail early</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">and</span> <span class="n">cat_choice</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="s2">&quot;Invalid category. It must match a preconfigured setting&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rating_input</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_OF_RATINGS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid rating. It must be a value between 0 and </span><span class="si">{</span><span class="n">NUM_OF_RATINGS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">Rating</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rating_object</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">cat_choice</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="n">rating_input</span><span class="p">)</span>
        <span class="n">user_rating</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
            <span class="n">user_rating</span> <span class="o">=</span> <span class="n">Rating</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">overall_rating</span> <span class="o">=</span> <span class="n">OverallRating</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">object_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
            <span class="n">r</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="s2">&quot;rating&quot;</span><span class="p">)</span>
        <span class="p">)[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span>
        <span class="n">overall_rating</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">overall_rating</span> <span class="ow">or</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="n">user_rating</span><span class="o">.</span><span class="n">rating</span> <span class="k">if</span> <span class="n">user_rating</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;overall_rating&quot;</span><span class="p">:</span> <span class="n">overall_rating</span><span class="p">})</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span> <span class="n">responses</span><span class="o">=</span><span class="p">{</span><span class="mi">200</span><span class="p">},</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;API endpoint allowing to set thumbnail of the Resource.&quot;</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">url_path</span><span class="o">=</span><span class="s2">&quot;set_thumbnail&quot;</span><span class="p">,</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;set_thumbnail&quot;</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;put&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsAuthenticated</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">],</span>
        <span class="n">parser_classes</span><span class="o">=</span><span class="p">[</span><span class="n">JSONParser</span><span class="p">,</span> <span class="n">MultiPartParser</span><span class="p">],</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.set_thumbnail">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.set_thumbnail">[docs]</a>
    <span class="k">def</span> <span class="nf">set_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Field file is required&quot;</span><span class="p">)</span>

        <span class="n">file_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">BASE64_PATTERN</span><span class="p">,</span> <span class="n">file_data</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">thumbnail</span><span class="p">,</span> <span class="n">_thumbnail_format</span> <span class="o">=</span> <span class="n">_decode_base64</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                        <span class="s2">&quot;The request body is not a valid base64 string or the image format is not PNG or JPEG&quot;</span><span class="p">,</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check if file_data is a valid url and set it as thumbail_url</span>
                    <span class="n">validate</span> <span class="o">=</span> <span class="n">URLValidator</span><span class="p">()</span>
                    <span class="n">validate</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
                            <span class="s2">&quot;The url must be of an image with format (png, jpeg or jpg)&quot;</span><span class="p">,</span>
                            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">resource</span><span class="o">.</span><span class="n">thumbnail_url</span> <span class="o">=</span> <span class="n">file_data</span>
                    <span class="n">resource</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;thumbnail_url&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">thumbnail_url</span><span class="p">})</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                        <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;file is either a file upload, ASCII byte string or a valid image url string&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate size</span>
            <span class="k">if</span> <span class="n">file_data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="s2">&quot;File must not exceed 1MB&quot;</span><span class="p">)</span>

            <span class="n">thumbnail</span> <span class="o">=</span> <span class="n">file_data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">file_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Invalid data provided&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thumbnail</span><span class="p">:</span>
            <span class="n">resource_manager</span><span class="o">.</span><span class="n">set_thumbnail</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span> <span class="n">thumbnail</span><span class="o">=</span><span class="n">thumbnail</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">({</span><span class="s2">&quot;thumbnail_url&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">thumbnail_url</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;Unable to set thumbnail&quot;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">)</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Get/Update/Delete/Add extra metadata for resource&quot;</span>
    <span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;put&quot;</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">IsOwnerOrAdmin</span><span class="p">,</span> <span class="n">UserHasPerms</span><span class="p">(</span><span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.add_resourcebase&quot;</span><span class="p">]}})],</span>
        <span class="n">url_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;extra_metadata&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;extra-metadata&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.extra_metadata">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.extra_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">extra_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        - PUT</span>
<span class="sd">        update specific metadata. The ID of the metadata is required to perform the update</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            {</span>
<span class="sd">                &quot;id&quot;: 1,</span>
<span class="sd">                &quot;name&quot;: &quot;foo_name&quot;,</span>
<span class="sd">                &quot;slug&quot;: &quot;foo_sug&quot;,</span>
<span class="sd">                &quot;help_text&quot;: &quot;object&quot;,</span>
<span class="sd">                &quot;field_type&quot;: &quot;int&quot;,</span>
<span class="sd">                &quot;value&quot;: &quot;object&quot;,</span>
<span class="sd">                &quot;category&quot;: &quot;object&quot;</span>
<span class="sd">            }</span>

<span class="sd">        - DELETE</span>
<span class="sd">            Expect a payload with the IDs of the metadata that should be deleted. Payload be like:</span>
<span class="sd">            [4, 3]</span>

<span class="sd">        - POST</span>

<span class="sd">        .. code-block:: yaml</span>

<span class="sd">            {</span>
<span class="sd">                &quot;name&quot;: &quot;foo_name&quot;,</span>
<span class="sd">                &quot;slug&quot;: &quot;foo_sug&quot;,</span>
<span class="sd">                &quot;help_text&quot;: &quot;object&quot;,</span>
<span class="sd">                &quot;field_type&quot;: &quot;int&quot;,</span>
<span class="sd">                &quot;value&quot;: &quot;object&quot;,</span>
<span class="sd">                &quot;category&quot;: &quot;object&quot;</span>
<span class="sd">            }</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_obj</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">ResourceBase</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
            <span class="c1"># get list of available metadata</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">_obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="n">_filters</span> <span class="o">=</span> <span class="p">[{</span><span class="sa">f</span><span class="s2">&quot;metadata__</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">_filters</span><span class="p">:</span>
                <span class="n">queryset</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">_filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ExtraMetadataSerializer</span><span class="p">()</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">queryset</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">extra_metadata</span> <span class="o">=</span> <span class="n">validate_extra_metadata</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_obj</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_m</span> <span class="ow">in</span> <span class="n">extra_metadata</span><span class="p">:</span>
                <span class="n">_id</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">_m</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;metadata updated for the selected resource&quot;</span><span class="p">)</span>
            <span class="n">_obj</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ExtraMetadataSerializer</span><span class="p">()</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">:</span>
            <span class="c1"># delete single metadata</span>
            <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">_obj</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ExtraMetadataSerializer</span><span class="p">()</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="c1"># add new metadata</span>
            <span class="k">for</span> <span class="n">_m</span> <span class="ow">in</span> <span class="n">extra_metadata</span><span class="p">:</span>
                <span class="n">new_m</span> <span class="o">=</span> <span class="n">ExtraMetadata</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">_obj</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">_m</span><span class="p">)</span>
                <span class="n">new_m</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="n">_obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_m</span><span class="p">)</span>
            <span class="n">_obj</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ExtraMetadataSerializer</span><span class="p">()</span><span class="o">.</span><span class="n">to_representation</span><span class="p">(</span><span class="n">_obj</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span></div>


<div class="viewcode-block" id="ResourceBaseViewSet._get_request_params">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet._get_request_params">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_request_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The request with the barer token access to the request.data during the token verification</span>
<span class="sd">        so in this case if the request.body cannot not access, we just re-access to the</span>
<span class="sd">        request.data to get the params needed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">QueryDict</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">encode</span>
                <span class="k">else</span> <span class="n">QueryDict</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span></div>


    <span class="nd">@extend_schema</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Get Linked Resources&quot;</span><span class="p">)</span>
    <span class="nd">@action</span><span class="p">(</span>
        <span class="n">detail</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">],</span>
        <span class="n">permission_classes</span><span class="o">=</span><span class="p">[</span><span class="n">UserHasPerms</span><span class="p">(</span><span class="n">perms_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;base.view_resourcebase&quot;</span><span class="p">]}})],</span>
        <span class="n">url_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;linked_resources&quot;</span><span class="p">,</span>  <span class="c1"># noqa</span>
        <span class="n">url_name</span><span class="o">=</span><span class="s2">&quot;linked_resources&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<div class="viewcode-block" id="ResourceBaseViewSet.linked_resources">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.ResourceBaseViewSet.linked_resources">[docs]</a>
    <span class="k">def</span> <span class="nf">linked_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">base_linked_resources</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span><span class="o">.</span><span class="n">get_real_instance</span><span class="p">(),</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="base_linked_resources">
<a class="viewcode-back" href="../../../../autoapi/geonode/base/api/views/index.html#geonode.base.api.views.base_linked_resources">[docs]</a>
<span class="k">def</span> <span class="nf">base_linked_resources</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">resource_type</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resource_type&quot;</span><span class="p">)</span>
        <span class="n">link_type</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;link_type&quot;</span><span class="p">)</span>
        <span class="n">type_list</span> <span class="o">=</span> <span class="n">resource_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">resource_type</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="n">warnings</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s2">&quot;page_size&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="s2">&quot;page&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">warnings</span><span class="p">[</span><span class="s2">&quot;PAGINATION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Pagination is not supported on this call&quot;</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;WARNINGS&quot;</span><span class="p">:</span> <span class="n">warnings</span><span class="p">}</span>

        <span class="n">get_visible_resources_p</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
            <span class="n">get_visible_resources</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span>
            <span class="n">admin_approval_required</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">ADMIN_MODERATE_UPLOADS</span><span class="p">,</span>
            <span class="n">unpublished_not_visible</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">RESOURCE_PUBLISHING</span><span class="p">,</span>
            <span class="n">private_groups_not_visibile</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">GROUP_PRIVATE_RESOURCES</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">link_type</span> <span class="ow">or</span> <span class="n">link_type</span> <span class="o">==</span> <span class="s2">&quot;linked_to&quot;</span><span class="p">:</span>
            <span class="c1"># list of linked resources, probably extended by ResourceBase&#39;s child class - may be loopable only once</span>
            <span class="n">linked_to_over</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_linked_resources</span><span class="p">()</span>

            <span class="c1"># resolve the ids of linked resources - using either e QuerySet (preferred) or a list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linked_to_over</span><span class="p">,</span> <span class="n">QuerySet</span><span class="p">):</span>
                <span class="n">linked_to_over_loopable</span> <span class="o">=</span> <span class="n">linked_to_over</span>
                <span class="n">linked_to_id_values</span> <span class="o">=</span> <span class="n">linked_to_over</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;target_id&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linked_to_over_loopable</span> <span class="o">=</span> <span class="p">[</span><span class="n">lr</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">linked_to_over</span><span class="p">]</span>
                <span class="n">linked_to_id_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">lr</span><span class="o">.</span><span class="n">target_id</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">linked_to_over_loopable</span><span class="p">]</span>

            <span class="c1"># filter resources by visibility / permissions</span>
            <span class="n">linked_to_visib</span> <span class="o">=</span> <span class="n">get_visible_resources_p</span><span class="p">(</span><span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">linked_to_id_values</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
                <span class="s2">&quot;-pk&quot;</span>
            <span class="p">)</span>
            <span class="c1"># optionally filter by resource type</span>
            <span class="n">linked_to_visib</span> <span class="o">=</span> <span class="n">linked_to_visib</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type__in</span><span class="o">=</span><span class="n">type_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">type_list</span> <span class="k">else</span> <span class="n">linked_to_visib</span>
            <span class="n">linked_to_visib_ids</span> <span class="o">=</span> <span class="n">linked_to_visib</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">linked_to</span> <span class="o">=</span> <span class="p">[</span><span class="n">lres</span> <span class="k">for</span> <span class="n">lres</span> <span class="ow">in</span> <span class="n">linked_to_over_loopable</span> <span class="k">if</span> <span class="n">lres</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">linked_to_visib_ids</span><span class="p">]</span>

            <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;linked_to&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinkedResourceSerializer</span><span class="p">(</span><span class="n">linked_to</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">link_type</span> <span class="ow">or</span> <span class="n">link_type</span> <span class="o">==</span> <span class="s2">&quot;linked_by&quot;</span><span class="p">:</span>
            <span class="n">linked_by_over</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_linked_resources</span><span class="p">(</span><span class="n">as_target</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linked_by_over</span><span class="p">,</span> <span class="n">QuerySet</span><span class="p">):</span>
                <span class="n">linked_by_over_loopable</span> <span class="o">=</span> <span class="n">linked_by_over</span>
                <span class="n">linked_by_id_values</span> <span class="o">=</span> <span class="n">linked_by_over</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;source_id&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linked_by_over_loopable</span> <span class="o">=</span> <span class="p">[</span><span class="n">lr</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">linked_by_over</span><span class="p">]</span>
                <span class="n">linked_by_id_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">lr</span><span class="o">.</span><span class="n">source_id</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">linked_by_over_loopable</span><span class="p">]</span>

            <span class="n">linked_by_visib</span> <span class="o">=</span> <span class="n">get_visible_resources_p</span><span class="p">(</span><span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">linked_by_id_values</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
                <span class="s2">&quot;-pk&quot;</span>
            <span class="p">)</span>

            <span class="n">linked_by_visib</span> <span class="o">=</span> <span class="n">linked_by_visib</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">resource_type__in</span><span class="o">=</span><span class="n">type_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">type_list</span> <span class="k">else</span> <span class="n">linked_by_visib</span>
            <span class="n">linked_by_visib_ids</span> <span class="o">=</span> <span class="n">linked_by_visib</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">linked_by</span> <span class="o">=</span> <span class="p">[</span><span class="n">lres</span> <span class="k">for</span> <span class="n">lres</span> <span class="ow">in</span> <span class="n">linked_by_over_loopable</span> <span class="k">if</span> <span class="n">lres</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">linked_by_visib_ids</span><span class="p">]</span>

            <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;linked_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinkedResourceSerializer</span><span class="p">(</span>
                <span class="n">instance</span><span class="o">=</span><span class="n">linked_by</span><span class="p">,</span> <span class="n">serialize_source</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kan Territory &amp; IT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>