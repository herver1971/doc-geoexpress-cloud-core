

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geonode.monitoring.models &mdash; GeoNode Cloud Core 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GeoNode Cloud Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenido</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GeoNode Cloud Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../geonode.html">geonode</a></li>
          <li class="breadcrumb-item"><a href="../monitoring.html">geonode.monitoring</a></li>
      <li class="breadcrumb-item active">geonode.monitoring.models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geonode.monitoring.models</h1><div class="highlight"><pre>
<span></span><span class="c1">#########################################################################</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2017 OSGeo</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1">#########################################################################</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>

<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">gethostbyname</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">get_user_model</span>
<span class="kn">from</span> <span class="nn">django.db.models.fields.json</span> <span class="kn">import</span> <span class="n">JSONField</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_noop</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.contrib.gis.geoip2</span> <span class="kn">import</span> <span class="n">GeoIP2</span> <span class="k">as</span> <span class="n">GeoIP</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">django.contrib.gis.geoip</span> <span class="kn">import</span> <span class="n">GeoIP</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">user_agents</span>
<span class="kn">from</span> <span class="nn">ipware</span> <span class="kn">import</span> <span class="n">get_client_ip</span>
<span class="kn">import</span> <span class="nn">pycountry</span>
<span class="kn">from</span> <span class="nn">geonode.monitoring.forms</span> <span class="kn">import</span> <span class="n">MultiEmailField</span>

<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Sum</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">Case</span><span class="p">,</span> <span class="n">When</span><span class="p">,</span> <span class="n">Max</span>

<div class="viewcode-block" id="log">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.log">[docs]</a>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="GEOIP_DB">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.GEOIP_DB">[docs]</a>
<span class="n">GEOIP_DB</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="get_geoip">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.get_geoip">[docs]</a>
<span class="k">def</span> <span class="nf">get_geoip</span><span class="p">():</span>
    <span class="c1"># defer init until it&#39;s really needed</span>
    <span class="c1"># otherwise, some cli commands may fail (like updating geouip)</span>
    <span class="k">global</span> <span class="n">GEOIP_DB</span>
    <span class="k">if</span> <span class="n">GEOIP_DB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">GEOIP_DB</span> <span class="o">=</span> <span class="n">GeoIP</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GEOIP_DB</span></div>



<div class="viewcode-block" id="Host">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Host">[docs]</a>
<span class="k">class</span> <span class="nc">Host</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Describes one physical instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Host.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Host.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Host.ip">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Host.ip">[docs]</a>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Host.active">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Host.active">[docs]</a>
    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Host.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Host.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Host: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="si">}</span><span class="s2">)&quot;</span></div>
</div>



<div class="viewcode-block" id="ServiceType">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType">[docs]</a>
<span class="k">class</span> <span class="nc">ServiceType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service Type list</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ServiceType.TYPE_GEONODE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.TYPE_GEONODE">[docs]</a>
    <span class="n">TYPE_GEONODE</span> <span class="o">=</span> <span class="s2">&quot;geonode&quot;</span></div>

<div class="viewcode-block" id="ServiceType.TYPE_GEOSERVER">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.TYPE_GEOSERVER">[docs]</a>
    <span class="n">TYPE_GEOSERVER</span> <span class="o">=</span> <span class="s2">&quot;geoserver&quot;</span></div>

<div class="viewcode-block" id="ServiceType.TYPE_HOST_GN">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.TYPE_HOST_GN">[docs]</a>
    <span class="n">TYPE_HOST_GN</span> <span class="o">=</span> <span class="s2">&quot;hostgeonode&quot;</span></div>

<div class="viewcode-block" id="ServiceType.TYPE_HOST_GS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.TYPE_HOST_GS">[docs]</a>
    <span class="n">TYPE_HOST_GS</span> <span class="o">=</span> <span class="s2">&quot;hostgeoserver&quot;</span></div>


<div class="viewcode-block" id="ServiceType.TYPES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.TYPES">[docs]</a>
    <span class="n">TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">TYPE_GEONODE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;GeoNode&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_GEOSERVER</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;GeoServer&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_HOST_GS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span>
                <span class="s2">&quot;Host (GeoServer)&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_HOST_GN</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span>
                <span class="s2">&quot;Host (GeoNode)&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="ServiceType.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TYPES</span><span class="p">)</span></div>


<div class="viewcode-block" id="ServiceType.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Service Type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="ServiceType.is_system_monitor">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceType.is_system_monitor">[docs]</a>
    <span class="k">def</span> <span class="nf">is_system_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_HOST_GN</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_HOST_GS</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service">[docs]</a>
<span class="k">class</span> <span class="nc">Service</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service is a entity describing deployed processes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Service.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.host">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.host">[docs]</a>
    <span class="n">host</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Host</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.check_interval">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.check_interval">[docs]</a>
    <span class="n">check_interval</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DurationField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">))</span></div>

<div class="viewcode-block" id="Service.last_check">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.last_check">[docs]</a>
    <span class="n">last_check</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.service_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.service_type">[docs]</a>
    <span class="n">service_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ServiceType</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.active">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.active">[docs]</a>
    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.notes">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.notes">[docs]</a>
    <span class="n">notes</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Service.url">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.url">[docs]</a>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Service.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Service: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="Service.get_metrics">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.get_metrics">[docs]</a>
    <span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">metric</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Service.is_hostgeonode">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.is_hostgeonode">[docs]</a>
    <span class="k">def</span> <span class="nf">is_hostgeonode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GN</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Service.is_hostgeoserver">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.is_hostgeoserver">[docs]</a>
    <span class="k">def</span> <span class="nf">is_hostgeoserver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GS</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Service.is_system_monitor">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Service.is_system_monitor">[docs]</a>
    <span class="k">def</span> <span class="nf">is_system_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">is_system_monitor</span></div>
</div>



<div class="viewcode-block" id="MonitoredResource">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource">[docs]</a>
<span class="k">class</span> <span class="nc">MonitoredResource</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="MonitoredResource.TYPE_EMPTY">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_EMPTY">[docs]</a>
    <span class="n">TYPE_EMPTY</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_LAYER">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_LAYER">[docs]</a>
    <span class="n">TYPE_LAYER</span> <span class="o">=</span> <span class="s2">&quot;dataset&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_MAP">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_MAP">[docs]</a>
    <span class="n">TYPE_MAP</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_RESOURCE_BASE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_RESOURCE_BASE">[docs]</a>
    <span class="n">TYPE_RESOURCE_BASE</span> <span class="o">=</span> <span class="s2">&quot;resource_base&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_DOCUMENT">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_DOCUMENT">[docs]</a>
    <span class="n">TYPE_DOCUMENT</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_STYLE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_STYLE">[docs]</a>
    <span class="n">TYPE_STYLE</span> <span class="o">=</span> <span class="s2">&quot;style&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_ADMIN">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_ADMIN">[docs]</a>
    <span class="n">TYPE_ADMIN</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_URL">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_URL">[docs]</a>
    <span class="n">TYPE_URL</span> <span class="o">=</span> <span class="s2">&quot;url&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource.TYPE_OTHER">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPE_OTHER">[docs]</a>
    <span class="n">TYPE_OTHER</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span></div>

<div class="viewcode-block" id="MonitoredResource._TYPES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource._TYPES">[docs]</a>
    <span class="n">_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">TYPE_EMPTY</span><span class="p">,</span>
        <span class="n">TYPE_LAYER</span><span class="p">,</span>
        <span class="n">TYPE_MAP</span><span class="p">,</span>
        <span class="n">TYPE_DOCUMENT</span><span class="p">,</span>
        <span class="n">TYPE_STYLE</span><span class="p">,</span>
        <span class="n">TYPE_ADMIN</span><span class="p">,</span>
        <span class="n">TYPE_URL</span><span class="p">,</span>
        <span class="n">TYPE_OTHER</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="MonitoredResource.TYPES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.TYPES">[docs]</a>
    <span class="n">TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">TYPE_EMPTY</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;No resource&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_LAYER</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Dataset&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_MAP</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Map&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_RESOURCE_BASE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Resource base&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_DOCUMENT</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Document&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_STYLE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Style&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_ADMIN</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Admin&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_URL</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;URL&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_OTHER</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Other&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="MonitoredResource.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MonitoredResource.type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.type">[docs]</a>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TYPES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">TYPE_EMPTY</span><span class="p">)</span></div>

<div class="viewcode-block" id="MonitoredResource.resource_id">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.resource_id">[docs]</a>
    <span class="n">resource_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="MonitoredResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<div class="viewcode-block" id="MonitoredResource.Meta.unique_together">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.Meta.unique_together">[docs]</a>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="MonitoredResource.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Monitored Resource: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="MonitoredResource.get">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MonitoredResource.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">or_create</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">or_create</span><span class="p">:</span>
            <span class="n">res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">resource_name</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric">[docs]</a>
<span class="k">class</span> <span class="nc">Metric</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="Metric.TYPE_RATE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.TYPE_RATE">[docs]</a>
    <span class="n">TYPE_RATE</span> <span class="o">=</span> <span class="s2">&quot;rate&quot;</span></div>

<div class="viewcode-block" id="Metric.TYPE_COUNT">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.TYPE_COUNT">[docs]</a>
    <span class="n">TYPE_COUNT</span> <span class="o">=</span> <span class="s2">&quot;count&quot;</span></div>

<div class="viewcode-block" id="Metric.TYPE_VALUE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.TYPE_VALUE">[docs]</a>
    <span class="n">TYPE_VALUE</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span></div>

<div class="viewcode-block" id="Metric.TYPE_VALUE_NUMERIC">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.TYPE_VALUE_NUMERIC">[docs]</a>
    <span class="n">TYPE_VALUE_NUMERIC</span> <span class="o">=</span> <span class="s2">&quot;value_numeric&quot;</span></div>

<div class="viewcode-block" id="Metric.TYPES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.TYPES">[docs]</a>
    <span class="n">TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">TYPE_RATE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rate&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_COUNT</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_VALUE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">TYPE_VALUE_NUMERIC</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Value numeric&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="Metric.AGGREGATE_MAP">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.AGGREGATE_MAP">[docs]</a>
    <span class="n">AGGREGATE_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">TYPE_RATE</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;(case when sum(samples_count)&gt; 0 &quot;</span> <span class="s2">&quot;then sum(value_num*samples_count)&quot;</span> <span class="s2">&quot;/sum(samples_count) else 0 end)&quot;</span>
        <span class="p">),</span>
        <span class="n">TYPE_VALUE</span><span class="p">:</span> <span class="s2">&quot;sum(value_num)&quot;</span><span class="p">,</span>
        <span class="n">TYPE_VALUE_NUMERIC</span><span class="p">:</span> <span class="s2">&quot;max(value_num)&quot;</span><span class="p">,</span>
        <span class="n">TYPE_COUNT</span><span class="p">:</span> <span class="s2">&quot;sum(value_num)&quot;</span><span class="p">,</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="Metric.AGGREGATE_DJANGO_MAP">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.AGGREGATE_DJANGO_MAP">[docs]</a>
    <span class="n">AGGREGATE_DJANGO_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">TYPE_RATE</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Sum</span><span class="p">(</span>
                <span class="n">Case</span><span class="p">(</span><span class="n">When</span><span class="p">(</span><span class="n">samples_count__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;value_num&quot;</span><span class="p">)),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">output_field</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">Sum</span><span class="p">(</span>
                <span class="n">Case</span><span class="p">(</span><span class="n">When</span><span class="p">(</span><span class="n">samples_count__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">then</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;samples_count&quot;</span><span class="p">)),</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">output_field</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">TYPE_VALUE</span><span class="p">:</span> <span class="n">Sum</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;value_num&quot;</span><span class="p">)),</span>
        <span class="n">TYPE_COUNT</span><span class="p">:</span> <span class="n">Sum</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;value_num&quot;</span><span class="p">)),</span>
        <span class="n">TYPE_VALUE_NUMERIC</span><span class="p">:</span> <span class="n">Max</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;value_num&quot;</span><span class="p">)),</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="Metric.UNIT_BYTES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_BYTES">[docs]</a>
    <span class="n">UNIT_BYTES</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_KILOBYTES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_KILOBYTES">[docs]</a>
    <span class="n">UNIT_KILOBYTES</span> <span class="o">=</span> <span class="s2">&quot;KB&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_MEGABYTES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_MEGABYTES">[docs]</a>
    <span class="n">UNIT_MEGABYTES</span> <span class="o">=</span> <span class="s2">&quot;MB&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_GIGABYTES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_GIGABYTES">[docs]</a>
    <span class="n">UNIT_GIGABYTES</span> <span class="o">=</span> <span class="s2">&quot;GB&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_BPS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_BPS">[docs]</a>
    <span class="n">UNIT_BPS</span> <span class="o">=</span> <span class="s2">&quot;B/s&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_MBPS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_MBPS">[docs]</a>
    <span class="n">UNIT_MBPS</span> <span class="o">=</span> <span class="s2">&quot;MB/s&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_KBPS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_KBPS">[docs]</a>
    <span class="n">UNIT_KBPS</span> <span class="o">=</span> <span class="s2">&quot;KB/s&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_GBPS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_GBPS">[docs]</a>
    <span class="n">UNIT_GBPS</span> <span class="o">=</span> <span class="s2">&quot;GB/s&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_SECONDS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_SECONDS">[docs]</a>
    <span class="n">UNIT_SECONDS</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_COUNT">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_COUNT">[docs]</a>
    <span class="n">UNIT_COUNT</span> <span class="o">=</span> <span class="s2">&quot;Count&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_RATE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_RATE">[docs]</a>
    <span class="n">UNIT_RATE</span> <span class="o">=</span> <span class="s2">&quot;Rate&quot;</span></div>

<div class="viewcode-block" id="Metric.UNIT_PERCENTAGE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNIT_PERCENTAGE">[docs]</a>
    <span class="n">UNIT_PERCENTAGE</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span></div>


<div class="viewcode-block" id="Metric.UNITS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.UNITS">[docs]</a>
    <span class="n">UNITS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">UNIT_BYTES</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bytes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_KILOBYTES</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Kilobytes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_MEGABYTES</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Megabytes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_GIGABYTES</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Gigabytes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_BPS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Bytes per second&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_KBPS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Kilobytes per second&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_MBPS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Megabytes per second&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_GBPS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Gigabytes per second&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_SECONDS</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Seconds&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_RATE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Rate&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_PERCENTAGE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Percentage&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">UNIT_COUNT</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="Metric.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Metric.description">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.description">[docs]</a>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Metric.type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.type">[docs]</a>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">TYPE_RATE</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TYPES</span><span class="p">)</span></div>

<div class="viewcode-block" id="Metric.unit">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.unit">[docs]</a>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">UNITS</span><span class="p">)</span></div>


<div class="viewcode-block" id="Metric.get_aggregate_field">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.get_aggregate_field">[docs]</a>
    <span class="k">def</span> <span class="nf">get_aggregate_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGGREGATE_DJANGO_MAP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Metric.get_aggregate_name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.get_aggregate_name">[docs]</a>
    <span class="k">def</span> <span class="nf">get_aggregate_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">AGGREGATE_MAP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span></div>


<div class="viewcode-block" id="Metric.__unicode__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.__unicode__">[docs]</a>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Metric: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Metric.is_rate">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.is_rate">[docs]</a>
    <span class="k">def</span> <span class="nf">is_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_RATE</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Metric.is_count">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.is_count">[docs]</a>
    <span class="k">def</span> <span class="nf">is_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_COUNT</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Metric.is_value_numeric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.is_value_numeric">[docs]</a>
    <span class="k">def</span> <span class="nf">is_value_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_VALUE_NUMERIC</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="Metric.is_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.is_value">[docs]</a>
    <span class="k">def</span> <span class="nf">is_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_VALUE</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Metric.get_for">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.Metric.get_for">[docs]</a>
    <span class="k">def</span> <span class="nf">get_for</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stype</span> <span class="o">=</span> <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_type</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span> <span class="n">metric__name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                <span class="n">metric</span> <span class="o">=</span> <span class="n">stype</span><span class="o">.</span><span class="n">metric</span>
            <span class="k">except</span> <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Http404</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">metric</span></div>
</div>



<div class="viewcode-block" id="ServiceTypeMetric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceTypeMetric">[docs]</a>
<span class="k">class</span> <span class="nc">ServiceTypeMetric</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="ServiceTypeMetric.service_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceTypeMetric.service_type">[docs]</a>
    <span class="n">service_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ServiceType</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServiceTypeMetric.metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceTypeMetric.metric">[docs]</a>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;service_type&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>


<div class="viewcode-block" id="ServiceTypeMetric.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ServiceTypeMetric.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">service_type</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span></div>
</div>



<div class="viewcode-block" id="EventType">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType">[docs]</a>
<span class="k">class</span> <span class="nc">EventType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="EventType._ows_types">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType._ows_types">[docs]</a>
    <span class="n">_ows_types</span> <span class="o">=</span> <span class="s2">&quot;tms wms-c wmts wcs wfs wms wps&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span></div>


    <span class="c1"># OWS_OTHER = &#39;other&#39;</span>
    <span class="c1"># OWS_ALL = &#39;all&#39;</span>
    <span class="c1"># OWS_TYPES = zip(_ows_types, _ows_types) + \</span>
    <span class="c1">#     [(OWS_ALL, _(&quot;All&quot;))] + [(OWS_OTHER, _(&quot;Other&quot;))]</span>

<div class="viewcode-block" id="EventType.EVENT_DOWNLOAD">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_DOWNLOAD">[docs]</a>
    <span class="n">EVENT_DOWNLOAD</span> <span class="o">=</span> <span class="s2">&quot;download&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_CREATE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_CREATE">[docs]</a>
    <span class="n">EVENT_CREATE</span> <span class="o">=</span> <span class="s2">&quot;create&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_CHANGE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_CHANGE">[docs]</a>
    <span class="n">EVENT_CHANGE</span> <span class="o">=</span> <span class="s2">&quot;change&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_CHANGE_METADATA">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_CHANGE_METADATA">[docs]</a>
    <span class="n">EVENT_CHANGE_METADATA</span> <span class="o">=</span> <span class="s2">&quot;change_metadata&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_REMOVE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_REMOVE">[docs]</a>
    <span class="n">EVENT_REMOVE</span> <span class="o">=</span> <span class="s2">&quot;remove&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_VIEW">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_VIEW">[docs]</a>
    <span class="n">EVENT_VIEW</span> <span class="o">=</span> <span class="s2">&quot;view&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_VIEW_METADATA">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_VIEW_METADATA">[docs]</a>
    <span class="n">EVENT_VIEW_METADATA</span> <span class="o">=</span> <span class="s2">&quot;view_metadata&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_PUBLISH">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_PUBLISH">[docs]</a>
    <span class="n">EVENT_PUBLISH</span> <span class="o">=</span> <span class="s2">&quot;publish&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_UPLOAD">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_UPLOAD">[docs]</a>
    <span class="n">EVENT_UPLOAD</span> <span class="o">=</span> <span class="s2">&quot;upload&quot;</span></div>

<div class="viewcode-block" id="EventType.EVENT_GEOSERVER">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_GEOSERVER">[docs]</a>
    <span class="n">EVENT_GEOSERVER</span> <span class="o">=</span> <span class="s2">&quot;geoserver&quot;</span>  <span class="c1"># other event from GS</span></div>

    <span class="c1"># special event types</span>
<div class="viewcode-block" id="EventType.EVENT_OWS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_OWS">[docs]</a>
    <span class="n">EVENT_OWS</span> <span class="o">=</span> <span class="s2">&quot;OWS:ALL&quot;</span>  <span class="c1"># any ows event</span></div>

<div class="viewcode-block" id="EventType.EVENT_OTHER">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_OTHER">[docs]</a>
    <span class="n">EVENT_OTHER</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>  <span class="c1"># non-ows event</span></div>

<div class="viewcode-block" id="EventType.EVENT_ALL">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_ALL">[docs]</a>
    <span class="n">EVENT_ALL</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>  <span class="c1"># all events - baseline: ows + non-ows</span></div>


<div class="viewcode-block" id="EventType.EVENT_TYPES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.EVENT_TYPES">[docs]</a>
    <span class="n">EVENT_TYPES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;OWS:</span><span class="si">{</span><span class="n">ows</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ows</span> <span class="ow">in</span> <span class="n">_ows_types</span><span class="p">],</span> <span class="n">_ows_types</span><span class="p">))</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_OTHER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Not OWS&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_OWS</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Any OWS&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_ALL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_CREATE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_UPLOAD</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Upload&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_CHANGE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Change&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_CHANGE_METADATA</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Change Metadata&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_VIEW_METADATA</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;View Metadata&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_VIEW</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;View&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_DOWNLOAD</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Download&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_PUBLISH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Publish&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_REMOVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Remove&quot;</span><span class="p">))]</span>
        <span class="o">+</span> <span class="p">[(</span><span class="n">EVENT_GEOSERVER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Geoserver event&quot;</span><span class="p">))]</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="EventType.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">EVENT_TYPES</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="EventType.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Event Type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="EventType.get">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_name</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">service_name</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span>
                <span class="ne">ValueError</span><span class="p">,</span>
                <span class="ne">TypeError</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">|</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">except</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="EventType.is_all">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.is_all">[docs]</a>
    <span class="k">def</span> <span class="nf">is_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVENT_ALL</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="EventType.is_other">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.is_other">[docs]</a>
    <span class="k">def</span> <span class="nf">is_other</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVENT_OTHER</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="EventType.is_ows">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.is_ows">[docs]</a>
    <span class="k">def</span> <span class="nf">is_ows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;OWS:&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="EventType.is_download">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.is_download">[docs]</a>
    <span class="k">def</span> <span class="nf">is_download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVENT_DOWNLOAD</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="EventType.is_view">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.EventType.is_view">[docs]</a>
    <span class="k">def</span> <span class="nf">is_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVENT_VIEW</span></div>
</div>



<div class="viewcode-block" id="RequestEvent">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent">[docs]</a>
<span class="k">class</span> <span class="nc">RequestEvent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="RequestEvent._methods">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._methods">[docs]</a>
    <span class="n">_methods</span> <span class="o">=</span> <span class="s2">&quot;get post head options put delete&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.METHODS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.METHODS">[docs]</a>
    <span class="n">METHODS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">_methods</span><span class="p">,</span> <span class="n">_methods</span><span class="p">))</span></div>

<div class="viewcode-block" id="RequestEvent.created">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.created">[docs]</a>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.received">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.received">[docs]</a>
    <span class="n">received</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.service">[docs]</a>
    <span class="n">service</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Service</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.event_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.event_type">[docs]</a>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">EventType</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.host">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.host">[docs]</a>
    <span class="n">host</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.request_path">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.request_path">[docs]</a>
    <span class="n">request_path</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>


    <span class="c1"># resources is a list of affected resources. it is buld as a pair of type and name:</span>
    <span class="c1">#  layer=geonode:sample_dataset01</span>
    <span class="c1"># or</span>
    <span class="c1">#  document=documents/id</span>
    <span class="c1"># or</span>
    <span class="c1">#  map=some map</span>
    <span class="c1">#</span>
    <span class="c1"># list is separated with newline</span>
    <span class="c1"># resources = models.TextField(blank=True, default=&#39;&#39;,</span>
    <span class="c1"># help_text=_(&quot;Resources name (style, layer, document, map)&quot;))</span>
<div class="viewcode-block" id="RequestEvent.resources">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.resources">[docs]</a>
    <span class="n">resources</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">MonitoredResource</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;List of resources affected&quot;</span><span class="p">),</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;requests&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="RequestEvent.request_method">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.request_method">[docs]</a>
    <span class="n">request_method</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">METHODS</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.response_status">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.response_status">[docs]</a>
    <span class="n">response_status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.response_size">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.response_size">[docs]</a>
    <span class="n">response_size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.response_time">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.response_time">[docs]</a>
    <span class="n">response_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Response processing time in ms&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="RequestEvent.response_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.response_type">[docs]</a>
    <span class="n">response_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.user_agent">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.user_agent">[docs]</a>
    <span class="n">user_agent</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.user_agent_family">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.user_agent_family">[docs]</a>
    <span class="n">user_agent_family</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_ip">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_ip">[docs]</a>
    <span class="n">client_ip</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GenericIPAddressField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_lat">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_lat">[docs]</a>
    <span class="n">client_lat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_lon">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_lon">[docs]</a>
    <span class="n">client_lon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_country">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_country">[docs]</a>
    <span class="n">client_country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_region">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_region">[docs]</a>
    <span class="n">client_region</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.client_city">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.client_city">[docs]</a>
    <span class="n">client_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="RequestEvent.custom_id">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.custom_id">[docs]</a>
    <span class="n">custom_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="c1"># keep user anonymized identifier</span>
<div class="viewcode-block" id="RequestEvent.user_identifier">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.user_identifier">[docs]</a>
    <span class="n">user_identifier</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="RequestEvent.user_username">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.user_username">[docs]</a>
    <span class="n">user_username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_resources">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_resources">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_resources</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">resources_list</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">rinst</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">MonitoredResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">type_name</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rinst</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_or_create_resources">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_or_create_resources">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_or_create_resources</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">res_name</span><span class="p">,</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">res_id</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">MonitoredResource</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">res_name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">res_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">res_id</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">resource_id</span> <span class="o">=</span> <span class="n">res_id</span>
            <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_geonode_resources">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_geonode_resources">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_geonode_resources</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return serialized resources affected by request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rqmeta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_monitoring&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">events</span> <span class="o">=</span> <span class="n">rqmeta</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># for type_name in &#39;layer map document style&#39;.split():</span>
        <span class="c1">#     res = rqmeta[&#39;resources&#39;].get(type_name) or []</span>
        <span class="c1">#     resources.extend(cls._get_resources(type_name, res))</span>

        <span class="k">for</span> <span class="n">evt_type</span><span class="p">,</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">res_name</span><span class="p">,</span> <span class="n">res_id</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">resources</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_get_or_create_resources</span><span class="p">(</span><span class="n">res_name</span><span class="p">,</span> <span class="n">res_type</span><span class="p">,</span> <span class="n">res_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">resources</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_event_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_event_type">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_event_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">default_event_type</span><span class="o">=</span><span class="s2">&quot;view&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns event type based on events</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rqmeta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_monitoring&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">rqmeta</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]}</span>
        <span class="n">event_name</span> <span class="o">=</span> <span class="n">default_event_type</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">event_name</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">default_event_type</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">default_event_type</span><span class="p">)</span>
            <span class="n">event_name</span> <span class="o">=</span> <span class="n">events</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">EventType</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="RequestEvent._get_ua_family">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_ua_family">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_ua_family</span><span class="p">(</span><span class="n">ua</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_agents</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ua</span><span class="p">))</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_user_agent">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_user_agent">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_user_agent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ua</span><span class="p">):</span>
        <span class="n">ua_family</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_ua_family</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;user_agent&quot;</span><span class="p">:</span> <span class="n">ua</span><span class="p">,</span> <span class="s2">&quot;user_agent_family&quot;</span><span class="p">:</span> <span class="n">ua_family</span><span class="p">}</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_user_consent">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_user_consent">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_user_consent</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">settings</span><span class="o">.</span><span class="n">USER_ANALYTICS_ENABLED</span></div>

        <span class="c1"># if  request.user.is_authenticated:</span>
        <span class="c1">#    return request.user.allow_analytics</span>
        <span class="c1"># return True</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_user_location">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_user_location">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_user_location</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request_ip</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">country</span> <span class="o">=</span> <span class="n">region</span> <span class="o">=</span> <span class="n">city</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">request_ip</span><span class="p">:</span>
            <span class="n">geoip</span> <span class="o">=</span> <span class="n">get_geoip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">request_ip</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,):</span>
                <span class="k">return</span> <span class="n">out</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">client_loc</span> <span class="o">=</span> <span class="n">geoip</span><span class="o">.</span><span class="n">city</span><span class="p">(</span><span class="n">request_ip</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Cannot resolve </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">request_ip</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                <span class="n">client_loc</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">client_loc</span><span class="p">:</span>
                <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">client_loc</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span>
                    <span class="n">client_loc</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">country</span> <span class="o">=</span> <span class="n">client_loc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country_code3&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">client_loc</span><span class="p">[</span><span class="s2">&quot;country_code&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">country</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">_c</span> <span class="o">=</span> <span class="n">pycountry</span><span class="o">.</span><span class="n">countries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">alpha_2</span><span class="o">=</span><span class="n">country</span><span class="p">)</span>
                    <span class="n">country</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">alpha_3</span>
                <span class="n">region</span> <span class="o">=</span> <span class="n">client_loc</span><span class="p">[</span><span class="s2">&quot;region&quot;</span><span class="p">]</span>
                <span class="n">city</span> <span class="o">=</span> <span class="n">client_loc</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span>

                <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;client_ip&quot;</span><span class="p">:</span> <span class="n">request_ip</span><span class="p">,</span>
                        <span class="s2">&quot;client_lat&quot;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
                        <span class="s2">&quot;client_lon&quot;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span>
                        <span class="s2">&quot;client_country&quot;</span><span class="p">:</span> <span class="n">country</span><span class="p">,</span>
                        <span class="s2">&quot;client_region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
                        <span class="s2">&quot;client_city&quot;</span><span class="p">:</span> <span class="n">city</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_user_data_gn">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_user_data_gn">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_user_data_gn</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># check consent</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_consent</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="n">rqmeta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_monitoring&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_identifier&quot;</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;user_identifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_identifier&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_username&quot;</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;user_username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_username&quot;</span><span class="p">)</span>

        <span class="n">ua</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HTTP_USER_AGENT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ua_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_agent</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ua_data</span><span class="p">)</span>

        <span class="n">request_ip</span><span class="p">,</span> <span class="n">is_routable</span> <span class="o">=</span> <span class="n">get_client_ip</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_ip</span> <span class="ow">and</span> <span class="n">is_routable</span><span class="p">:</span>
            <span class="n">location_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_location</span><span class="p">(</span><span class="n">request_ip</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">location_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent._get_user_data_gs">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent._get_user_data_gs">[docs]</a>
    <span class="k">def</span> <span class="nf">_get_user_data_gs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># check consent</span>
        <span class="c1"># if not cls._get_user_consent(request):</span>
        <span class="c1">#    return out</span>

        <span class="n">ua</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remoteUserAgent&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ua_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_agent</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ua_data</span><span class="p">)</span>

        <span class="n">request_ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;remoteAddr&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_ip</span><span class="p">:</span>
            <span class="n">location_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_location</span><span class="p">(</span><span class="n">request_ip</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">location_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent.from_geonode">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.from_geonode">[docs]</a>
    <span class="k">def</span> <span class="nf">from_geonode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">geonode.utils</span> <span class="kn">import</span> <span class="n">parse_datetime</span>

        <span class="n">received</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">rqmeta</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_monitoring&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">created</span> <span class="o">=</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;started&quot;</span><span class="p">,</span> <span class="n">received</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">created</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="n">created</span><span class="p">)</span>
        <span class="n">_ended</span> <span class="o">=</span> <span class="n">rqmeta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;finished&quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ended</span> <span class="o">-</span> <span class="n">created</span><span class="p">)</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">/</span> <span class="mf">1000.0</span>

        <span class="n">sensitive_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_data_gn</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_event_type</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;received&quot;</span><span class="p">:</span> <span class="n">received</span><span class="p">,</span>
            <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">(),</span>
            <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span>
            <span class="s2">&quot;user_identifier&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;user_username&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">,</span>
            <span class="s2">&quot;request_path&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">(),</span>
            <span class="s2">&quot;request_method&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="s2">&quot;response_status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="s2">&quot;response_size&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-length&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()),</span>
            <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">),</span>
            <span class="s2">&quot;response_time&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sensitive_data</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
            <span class="n">resources</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_geonode_resources</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resources</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">resources</span><span class="p">)</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">inst</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RequestEvent.from_geoserver">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.RequestEvent.from_geoserver">[docs]</a>
    <span class="k">def</span> <span class="nf">from_geoserver</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">request_data</span><span class="p">,</span> <span class="n">received</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes RequestEvent for data from audit log in GS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">dateutil.tz</span> <span class="kn">import</span> <span class="n">tzlocal</span>
        <span class="kn">from</span> <span class="nn">geonode.utils</span> <span class="kn">import</span> <span class="n">parse_datetime</span>

        <span class="n">rd</span> <span class="o">=</span> <span class="n">request_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;org.geoserver.monitor.RequestData&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rd</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No request data payload in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">request_data</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;FINISHED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FAILED&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;request not finished </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">received</span> <span class="o">=</span> <span class="n">received</span> <span class="ow">or</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="n">sensitive_data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_user_data_gs</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>

        <span class="c1"># ua = rd.get(&#39;remoteUserAgent&#39;) or &#39;&#39;</span>
        <span class="c1"># ua_family = cls._get_ua_family(ua)</span>
        <span class="c1"># ip = rd[&#39;remoteAddr&#39;]</span>
        <span class="c1"># lat = lon = None</span>
        <span class="c1"># country = region = city = None</span>
        <span class="c1"># if ip:</span>
        <span class="c1">#     geoip = get_geoip()</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         client_loc = geoip.city(ip)</span>
        <span class="c1">#     except Exception as err:</span>
        <span class="c1">#         log.warning(&quot;Cannot resolve %s: %s&quot;, ip, err)</span>
        <span class="c1">#         client_loc = None</span>
        <span class="c1">#</span>
        <span class="c1">#     if client_loc:</span>
        <span class="c1">#         lat, lon = client_loc[&#39;latitude&#39;], client_loc[&#39;longitude&#39;],</span>
        <span class="c1">#         country = client_loc.get(</span>
        <span class="c1">#             &#39;country_code3&#39;) or client_loc[&#39;country_code&#39;]</span>
        <span class="c1">#         if len(country) == 2:</span>
        <span class="c1">#             _c = pycountry.countries.get(alpha_2=country)</span>
        <span class="c1">#             country = _c.alpha_3</span>
        <span class="c1">#         region = client_loc[&#39;region&#39;]</span>
        <span class="c1">#         city = client_loc[&#39;city&#39;]</span>

        <span class="n">utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">local_tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tzlocal</span><span class="p">())</span><span class="o">.</span><span class="n">tzname</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">local_tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">TIME_ZONE</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;startTime&quot;</span><span class="p">])</span>
        <span class="c1"># Assuming GeoServer stores dates @ UTC</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">start_time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">local_tz</span><span class="p">)</span>

        <span class="n">rl</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;responseLength&quot;</span><span class="p">]</span>
        <span class="n">event_type_name</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;service&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event_type_name</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="n">EventType</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OWS:</span><span class="si">{</span><span class="n">event_type_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event_type</span> <span class="o">=</span> <span class="n">EventType</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">EventType</span><span class="o">.</span><span class="n">EVENT_GEOSERVER</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;queryString&quot;</span><span class="p">):</span>
            <span class="n">request_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">rd</span><span class="p">[</span><span class="s1">&#39;queryString&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">request_path</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span>
            <span class="s2">&quot;received&quot;</span><span class="p">:</span> <span class="n">received</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">],</span>
            <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">event_type</span><span class="p">,</span>
            <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span>
            <span class="s2">&quot;request_path&quot;</span><span class="p">:</span> <span class="n">request_path</span><span class="p">,</span>
            <span class="s2">&quot;request_method&quot;</span><span class="p">:</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;httpMethod&quot;</span><span class="p">],</span>
            <span class="s2">&quot;response_status&quot;</span><span class="p">:</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;responseStatus&quot;</span><span class="p">],</span>
            <span class="s2">&quot;response_size&quot;</span><span class="p">:</span> <span class="n">rl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rl</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">rl</span><span class="p">,</span>
            <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;responseContentType&quot;</span><span class="p">),</span>
            <span class="s2">&quot;response_time&quot;</span><span class="p">:</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;totalTime&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sensitive_data</span><span class="p">)</span>

        <span class="n">inst</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="n">resource_names</span> <span class="o">=</span> <span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resources&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource_names</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">resource_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">resource_names</span><span class="p">]</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_resources</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">resource_names</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">etype</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;@class&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;@class&quot;</span> <span class="ow">in</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;class&quot;</span><span class="p">]</span>
                <span class="n">edata</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;stackTrace&quot;</span><span class="p">][</span><span class="s2">&quot;trace&quot;</span><span class="p">])</span>
                <span class="n">emessage</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;detailMessage&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;detailMessage&quot;</span> <span class="ow">in</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
                <span class="n">ExceptionEvent</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">edata</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">emessage</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">inst</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">emessage</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;detailMessage&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;detailMessage&quot;</span> <span class="ow">in</span> <span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
                <span class="n">ExceptionEvent</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span>
                    <span class="n">service</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rd</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">][</span><span class="s2">&quot;stackTrace&quot;</span><span class="p">][</span><span class="s2">&quot;trace&quot;</span><span class="p">]),</span> <span class="n">message</span><span class="o">=</span><span class="n">emessage</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">inst</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">resources</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">resources</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">inst</span></div>
</div>



<div class="viewcode-block" id="ExceptionEvent">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent">[docs]</a>
<span class="k">class</span> <span class="nc">ExceptionEvent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="ExceptionEvent.created">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.created">[docs]</a>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.received">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.received">[docs]</a>
    <span class="n">received</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.service">[docs]</a>
    <span class="n">service</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Service</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.error_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.error_type">[docs]</a>
    <span class="n">error_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.error_message">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.error_message">[docs]</a>
    <span class="n">error_message</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.error_data">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.error_data">[docs]</a>
    <span class="n">error_data</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExceptionEvent.request">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.request">[docs]</a>
    <span class="n">request</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">RequestEvent</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;exceptions&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ExceptionEvent.add_error">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.add_error">[docs]</a>
    <span class="k">def</span> <span class="nf">add_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">from_service</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span> <span class="n">stack_trace</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">received</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_cls</span> <span class="o">=</span> <span class="n">error_type</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">error_type</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stack_trace</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">stack_trace</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stack_trace</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">created</span> <span class="o">=</span> <span class="n">received</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span>
            <span class="n">received</span><span class="o">=</span><span class="n">received</span><span class="p">,</span>
            <span class="n">service</span><span class="o">=</span><span class="n">from_service</span><span class="p">,</span>
            <span class="n">error_type</span><span class="o">=</span><span class="n">error_type</span><span class="p">,</span>
            <span class="n">error_data</span><span class="o">=</span><span class="n">stack_trace</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="ExceptionEvent.url">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.url">[docs]</a>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;monitoring:api_exception&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="ExceptionEvent.service_data">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.service_data">[docs]</a>
    <span class="k">def</span> <span class="nf">service_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">name</span><span class="p">}</span></div>


<div class="viewcode-block" id="ExceptionEvent.expose">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.ExceptionEvent.expose">[docs]</a>
    <span class="k">def</span> <span class="nf">expose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;error_type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">error_type</span><span class="p">,</span>
            <span class="s2">&quot;error_data&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">error_data</span><span class="p">,</span>
            <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">error_message</span><span class="p">,</span>
            <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">created</span><span class="p">,</span>
            <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="o">.</span><span class="n">name</span><span class="p">},</span>
            <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">created</span><span class="p">,</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">request_method</span><span class="p">,</span>
                    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">request_path</span><span class="p">,</span>
                    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">host</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;event_type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">event_type</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">event_type</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)}</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">client_ip</span><span class="p">,</span>
                    <span class="s2">&quot;user_agent&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user_agent</span><span class="p">,</span>
                    <span class="s2">&quot;user_agent_family&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user_agent_family</span><span class="p">,</span>
                    <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">client_lat</span><span class="p">,</span>
                        <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">client_lon</span><span class="p">,</span>
                        <span class="s2">&quot;country&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">client_country</span><span class="p">,</span>
                        <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">client_city</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">},</span>
                <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response_size</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response_status</span><span class="p">,</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response_time</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">response_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span></div>
</div>



<div class="viewcode-block" id="MetricLabel">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricLabel">[docs]</a>
<span class="k">class</span> <span class="nc">MetricLabel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="MetricLabel.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricLabel.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricLabel.user">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricLabel.user">[docs]</a>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetricLabel.__unicode__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricLabel.__unicode__">[docs]</a>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Metric Label: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>
</div>



<div class="viewcode-block" id="MetricValue">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue">[docs]</a>
<span class="k">class</span> <span class="nc">MetricValue</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="MetricValue.valid_from">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.valid_from">[docs]</a>
    <span class="n">valid_from</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.valid_to">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.valid_to">[docs]</a>
    <span class="n">valid_to</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.service_metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.service_metric">[docs]</a>
    <span class="n">service_metric</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">ServiceTypeMetric</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.service">[docs]</a>
    <span class="n">service</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Service</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.event_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.event_type">[docs]</a>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">EventType</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;metric_values&quot;</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.resource">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.resource">[docs]</a>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">MonitoredResource</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;metric_values&quot;</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.label">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.label">[docs]</a>
    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">MetricLabel</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;metric_values&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.value">[docs]</a>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.value_num">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.value_num">[docs]</a>
    <span class="n">value_num</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.value_raw">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.value_raw">[docs]</a>
    <span class="n">value_raw</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.samples_count">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.samples_count">[docs]</a>
    <span class="n">samples_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricValue.data">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.data">[docs]</a>
    <span class="n">data</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetricValue.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
<div class="viewcode-block" id="MetricValue.Meta.unique_together">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.Meta.unique_together">[docs]</a>
        <span class="n">unique_together</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;valid_from&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valid_to&quot;</span><span class="p">,</span>
            <span class="s2">&quot;service&quot;</span><span class="p">,</span>
            <span class="s2">&quot;service_metric&quot;</span><span class="p">,</span>
            <span class="s2">&quot;resource&quot;</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">,</span>
            <span class="s2">&quot;event_type&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="MetricValue.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_metric</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">name</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">_l</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="n">_s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">_s</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Metric Value: </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">] (since </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_from</span><span class="si">}</span><span class="s2"> until </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_to</span><span class="si">}</span><span class="s2">)&quot;</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="MetricValue.add">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.add">[docs]</a>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">metric</span><span class="p">,</span>
        <span class="n">valid_from</span><span class="p">,</span>
        <span class="n">valid_to</span><span class="p">,</span>
        <span class="n">service</span><span class="p">,</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">value_raw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">value_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">event_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">samples_count</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new MetricValue shortcut</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
            <span class="n">service_metric</span> <span class="o">=</span> <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_type</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">service_metric</span> <span class="o">=</span> <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service_type</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="p">,</span> <span class="n">metric__name</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>

        <span class="n">label_name</span> <span class="o">=</span> <span class="n">label</span>
        <span class="n">label_user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">label_name</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">label_user</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">MetricLabel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label_name</span> <span class="ow">or</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MetricLabel</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">MetricLabel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">label_name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">and</span> <span class="n">label_user</span><span class="p">:</span>
            <span class="n">label</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">label_user</span>
            <span class="n">label</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">EventType</span><span class="p">):</span>
                <span class="n">event_type</span> <span class="o">=</span> <span class="n">EventType</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_type</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">valid_from</span><span class="o">=</span><span class="n">valid_from</span><span class="p">,</span>
                <span class="n">valid_to</span><span class="o">=</span><span class="n">valid_to</span><span class="p">,</span>
                <span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
                <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
                <span class="n">service_metric</span><span class="o">=</span><span class="n">service_metric</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">value_raw</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value_raw</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_raw</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">value_num</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value_num</span><span class="p">)</span> <span class="k">if</span> <span class="n">value_num</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">samples_count</span> <span class="o">=</span> <span class="n">samples_count</span> <span class="ow">or</span> <span class="mi">0</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">inst</span>
        <span class="k">except</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">valid_from</span><span class="o">=</span><span class="n">valid_from</span><span class="p">,</span>
            <span class="n">valid_to</span><span class="o">=</span><span class="n">valid_to</span><span class="p">,</span>
            <span class="n">service</span><span class="o">=</span><span class="n">service</span><span class="p">,</span>
            <span class="n">service_metric</span><span class="o">=</span><span class="n">service_metric</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">value_raw</span><span class="p">,</span>
            <span class="n">value_raw</span><span class="o">=</span><span class="n">value_raw</span><span class="p">,</span>
            <span class="n">value_num</span><span class="o">=</span><span class="n">value_num</span><span class="p">,</span>
            <span class="n">samples_count</span><span class="o">=</span><span class="n">samples_count</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="MetricValue.get_for">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricValue.get_for">[docs]</a>
    <span class="k">def</span> <span class="nf">get_for</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">valid_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">qparams</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">Metric</span><span class="p">):</span>
            <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">service_metric__metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">service_metric__metric__name</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">service</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">Service</span><span class="p">):</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">service_metric__service_type</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="n">service_type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">ServiceType</span><span class="p">):</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">service_metric__service_type</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">service_metric__service_type__name</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">valid_on</span><span class="p">:</span>
            <span class="n">qwhen</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">valid_from__lte</span><span class="o">=</span><span class="n">valid_on</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">valid_to__gte</span><span class="o">=</span><span class="n">valid_on</span><span class="p">)</span>
            <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">qwhen</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">MetricLabel</span><span class="p">):</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">label__name</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">MonitoredResource</span><span class="p">):</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rtype</span><span class="p">,</span> <span class="n">rname</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">resource__type</span><span class="o">=</span><span class="n">rtype</span><span class="p">,</span> <span class="n">resource__name</span><span class="o">=</span><span class="n">rname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">EventType</span><span class="p">):</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qparams</span> <span class="o">=</span> <span class="n">qparams</span> <span class="o">&amp;</span> <span class="n">models</span><span class="o">.</span><span class="n">Q</span><span class="p">(</span><span class="n">event_type__name</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">qparams</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-valid_to&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span></div>
</div>



<div class="viewcode-block" id="NotificationCheck">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck">[docs]</a>
<span class="k">class</span> <span class="nc">NotificationCheck</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="NotificationCheck.GRACE_PERIOD_1M">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIOD_1M">[docs]</a>
    <span class="n">GRACE_PERIOD_1M</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.GRACE_PERIOD_5M">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIOD_5M">[docs]</a>
    <span class="n">GRACE_PERIOD_5M</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.GRACE_PERIOD_10M">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIOD_10M">[docs]</a>
    <span class="n">GRACE_PERIOD_10M</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.GRACE_PERIOD_30M">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIOD_30M">[docs]</a>
    <span class="n">GRACE_PERIOD_30M</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.GRACE_PERIOD_1H">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIOD_1H">[docs]</a>
    <span class="n">GRACE_PERIOD_1H</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.GRACE_PERIODS">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.GRACE_PERIODS">[docs]</a>
    <span class="n">GRACE_PERIODS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">GRACE_PERIOD_1M</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;1 minute&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">GRACE_PERIOD_5M</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;5 minutes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">GRACE_PERIOD_10M</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;10 minutes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">GRACE_PERIOD_30M</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;30 minutes&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">GRACE_PERIOD_1H</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;1 hour&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="NotificationCheck.SEVERITY_WARNING">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.SEVERITY_WARNING">[docs]</a>
    <span class="n">SEVERITY_WARNING</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span></div>

<div class="viewcode-block" id="NotificationCheck.SEVERITY_ERROR">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.SEVERITY_ERROR">[docs]</a>
    <span class="n">SEVERITY_ERROR</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span></div>

<div class="viewcode-block" id="NotificationCheck.SEVERITY_FATAL">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.SEVERITY_FATAL">[docs]</a>
    <span class="n">SEVERITY_FATAL</span> <span class="o">=</span> <span class="s2">&quot;fatal&quot;</span></div>


<div class="viewcode-block" id="NotificationCheck.SEVERITIES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.SEVERITIES">[docs]</a>
    <span class="n">SEVERITIES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">SEVERITY_WARNING</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">SEVERITY_ERROR</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">SEVERITY_FATAL</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Fatal&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="NotificationCheck.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.name">[docs]</a>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.description">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.description">[docs]</a>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s2">&quot;Description of the alert&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.user_threshold">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.user_threshold">[docs]</a>
    <span class="n">user_threshold</span> <span class="o">=</span> <span class="n">JSONField</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Expected min/max values for user configuration&quot;</span><span class="p">)</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.metrics">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.metrics">[docs]</a>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">through</span><span class="o">=</span><span class="s2">&quot;NotificationMetricDefinition&quot;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.last_send">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.last_send">[docs]</a>
    <span class="n">last_send</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Marker of last delivery&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="NotificationCheck.grace_period">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.grace_period">[docs]</a>
    <span class="n">grace_period</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DurationField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">GRACE_PERIOD_10M</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">GRACE_PERIODS</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Minimum time between subsequent notifications&quot;</span><span class="p">),</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.severity">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.severity">[docs]</a>
    <span class="n">severity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">SEVERITY_ERROR</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">SEVERITIES</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;How severe would be error from this notification&quot;</span><span class="p">),</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="NotificationCheck.active">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.active">[docs]</a>
    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Is it active&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="NotificationCheck.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Notification Check #</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.notification_subject">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.notification_subject">[docs]</a>
    <span class="k">def</span> <span class="nf">notification_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.is_warning">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.is_warning">[docs]</a>
    <span class="k">def</span> <span class="nf">is_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEVERITY_WARNING</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.is_error">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.is_error">[docs]</a>
    <span class="k">def</span> <span class="nf">is_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEVERITY_ERROR</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.is_fatal">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.is_fatal">[docs]</a>
    <span class="k">def</span> <span class="nf">is_fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SEVERITY_FATAL</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.can_send">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.can_send">[docs]</a>
    <span class="k">def</span> <span class="nf">can_send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">now</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="NotificationCheck.mark_send">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.mark_send">[docs]</a>
    <span class="k">def</span> <span class="nf">mark_send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_send</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.url">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.url">[docs]</a>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s2">&quot;monitoring:api_user_notification_config&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span></div>


<div class="viewcode-block" id="NotificationCheck.get_users">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_users">[docs]</a>
    <span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">user</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">user__isnull</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)]</span></div>


<div class="viewcode-block" id="NotificationCheck.get_emails">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_emails">[docs]</a>
    <span class="k">def</span> <span class="nf">get_emails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">email</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">email__isnull</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationCheck.emails">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.emails">[docs]</a>
    <span class="k">def</span> <span class="nf">emails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emails</span><span class="p">()</span> <span class="k">if</span> <span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">email</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">email</span><span class="p">]</span></div>


<div class="viewcode-block" id="NotificationCheck.check_notifications">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.check_notifications">[docs]</a>
    <span class="k">def</span> <span class="nf">check_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ch</span><span class="o">.</span><span class="n">check_metric</span><span class="p">(</span><span class="n">for_timestamp</span><span class="o">=</span><span class="n">for_timestamp</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">MetricValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">checks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="c1"># no value available, ignoring</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">checks</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NotificationCheck.check_for">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.check_for">[docs]</a>
    <span class="k">def</span> <span class="nf">check_for</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">for_timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">checked</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">q</span><span class="p">):</span>
            <span class="n">checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">n</span><span class="p">,</span>
                    <span class="n">n</span><span class="o">.</span><span class="n">check_notifications</span><span class="p">(</span><span class="n">for_timestamp</span><span class="o">=</span><span class="n">for_timestamp</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">checked</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NotificationCheck.get_steps">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_steps">[docs]</a>
    <span class="k">def</span> <span class="nf">get_steps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">min_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot use numeric threshold if one of min/max is None&quot;</span><span class="p">)</span>
            <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_</span> <span class="o">-</span> <span class="n">min_</span><span class="p">)</span> <span class="o">/</span> <span class="n">thresholds</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">min_</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">max_</span><span class="p">:</span>
                <span class="n">thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">+=</span> <span class="n">step</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">GeneratorType</span><span class="p">)):</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="n">thresholds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported threshold type: </span><span class="si">{</span><span class="n">thresholds</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">thresholds</span></div>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="NotificationCheck.create">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.create">[docs]</a>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">user_threshold</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">inst</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">user_thresholds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">metric_name</span><span class="p">,</span>
            <span class="n">field_opt</span><span class="p">,</span>
            <span class="n">use_service</span><span class="p">,</span>
            <span class="n">use_resource</span><span class="p">,</span>
            <span class="n">use_label</span><span class="p">,</span>
            <span class="n">use_event_type</span><span class="p">,</span>
            <span class="n">minimum</span><span class="p">,</span>
            <span class="n">maximum</span><span class="p">,</span>
            <span class="n">thresholds</span><span class="p">,</span>
            <span class="n">_description</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">user_threshold</span><span class="p">:</span>
            <span class="c1"># metric_name is a string for metric.name</span>
            <span class="c1"># field opt is NotificationMetricDefinition.FIELD_OPTION* value</span>
            <span class="c1"># use_* are flags to set limitations on scope of alert</span>
            <span class="c1"># minimum, maximum are min/max for allowed values</span>
            <span class="c1">#   if one is None, that means there&#39;s no value limit in that direction</span>
            <span class="c1"># thresholds can be :</span>
            <span class="c1">#     * list of values between min and max or</span>
            <span class="c1">#     * one number of steps between min and max</span>
            <span class="c1">#     * None, then user can enter value manually</span>
            <span class="c1">#</span>
            <span class="c1"># example:</span>
            <span class="c1"># notfication: system overload</span>
            <span class="c1">#  (&#39;request.count&#39;, &#39;min_value&#39;, True, True, True, True,</span>
            <span class="c1">#    0, None, (100, 200, 500, 1000,)</span>

            <span class="n">metric</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">metric_name</span><span class="p">)</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_steps</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">)</span>
            <span class="n">nm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">NotificationMetricDefinition</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
                <span class="n">notification_check</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span>
                <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">_description</span><span class="p">,</span>
                <span class="n">min_value</span><span class="o">=</span><span class="n">minimum</span><span class="p">,</span>
                <span class="n">max_value</span><span class="o">=</span><span class="n">maximum</span><span class="p">,</span>
                <span class="n">steps</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="k">if</span> <span class="n">steps</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">field_option</span><span class="o">=</span><span class="n">field_opt</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">user_thresholds</span><span class="p">[</span><span class="n">nm</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">minimum</span><span class="p">,</span>
                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">maximum</span><span class="p">,</span>
                <span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">_description</span><span class="p">,</span>
                <span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="n">steps</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">user_threshold</span> <span class="o">=</span> <span class="n">user_thresholds</span>
        <span class="k">if</span> <span class="n">severity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="n">severity</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">inst</span></div>


<div class="viewcode-block" id="NotificationCheck.get_user_threshold">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_user_threshold">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notification_def</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_threshold</span><span class="p">[</span><span class="n">notification_def</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span></div>


<div class="viewcode-block" id="NotificationCheck.get_user_form">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_user_form">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return form to validate metric thresholds input from user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">this</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">defs</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">definitions</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">F</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="n">MultiEmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">severity</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SEVERITIES</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">active</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">grace_period</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DurationField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">initial</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;emails&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">get_emails</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">email</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">this</span><span class="o">.</span><span class="n">get_users</span><span class="p">()],</span>
                    <span class="s2">&quot;severity&quot;</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">severity</span><span class="p">,</span>
                    <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">active</span><span class="p">,</span>
                    <span class="s2">&quot;grace_period&quot;</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">grace_period</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;initial&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
                    <span class="c1"># def.get_fields() can return several fields,</span>
                    <span class="c1"># especially when we have per-resource monitoring</span>
                    <span class="n">_fields</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">_fields</span><span class="p">:</span>
                        <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>

        <span class="k">return</span> <span class="n">F</span><span class="p">(</span><span class="o">*</span><span class="n">args_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_</span><span class="p">)</span></div>


<div class="viewcode-block" id="NotificationCheck.process_user_form">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.process_user_form">[docs]</a>
    <span class="k">def</span> <span class="nf">process_user_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">is_json</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process form data from user and create Notifica</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">inst</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">current_checks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_json</span><span class="p">:</span>
            <span class="n">emails</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;emails&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">emails</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">emails</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">emails</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emails</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;emails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">emails</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_form</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
            <span class="n">err</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">errors</span>
            <span class="k">raise</span> <span class="n">err</span>
        <span class="n">current_checks</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;emails&quot;</span><span class="p">)</span>
        <span class="n">active</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>
        <span class="n">severity</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">grace_period</span> <span class="o">=</span> <span class="n">fdata</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;grace_period&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">severity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="n">severity</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">active</span>
        <span class="k">if</span> <span class="n">grace_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grace_period</span> <span class="o">=</span> <span class="n">grace_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># do not create notification check if check value is empty</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">_v</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="c1"># syntax of field name:</span>
            <span class="c1"># field_id.metric.name.field_name</span>
            <span class="n">mname</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_v</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">_v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="s2">&quot;max_timeout&quot;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">ndef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_definition_for</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">ncheck</span> <span class="o">=</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">notification_check</span><span class="o">=</span><span class="n">inst</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="n">ndef</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="n">val</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncheck</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">get_user_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receivers</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;notification_check&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">U</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span>
            <span class="n">NotificationReceiver</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="NotificationCheck.get_definition_for">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationCheck.get_definition_for">[docs]</a>
    <span class="k">def</span> <span class="nf">get_definition_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">def_name</span><span class="p">):</span>
        <span class="n">_v</span> <span class="o">=</span> <span class="n">def_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="c1"># syntax of field name:</span>
        <span class="c1"># field_id.metric.name.field_name</span>
        <span class="n">mname</span><span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_v</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">_v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">definitions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric__name</span><span class="o">=</span><span class="n">mname</span><span class="p">,</span> <span class="n">field_option</span><span class="o">=</span><span class="n">field</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="NotificationReceiver">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationReceiver">[docs]</a>
<span class="k">class</span> <span class="nc">NotificationReceiver</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="NotificationReceiver.notification_check">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationReceiver.notification_check">[docs]</a>
    <span class="n">notification_check</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">NotificationCheck</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;receivers&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationReceiver.user">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationReceiver.user">[docs]</a>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationReceiver.email">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationReceiver.email">[docs]</a>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="NotificationReceiver.save">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationReceiver.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot save empty notification receiver&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="NotificationMetricDefinition">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition">[docs]</a>
<span class="k">class</span> <span class="nc">NotificationMetricDefinition</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="NotificationMetricDefinition.FIELD_OPTION_MIN_VALUE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.FIELD_OPTION_MIN_VALUE">[docs]</a>
    <span class="n">FIELD_OPTION_MIN_VALUE</span> <span class="o">=</span> <span class="s2">&quot;min_value&quot;</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.FIELD_OPTION_MAX_VALUE">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.FIELD_OPTION_MAX_VALUE">[docs]</a>
    <span class="n">FIELD_OPTION_MAX_VALUE</span> <span class="o">=</span> <span class="s2">&quot;max_value&quot;</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.FIELD_OPTION_MAX_TIMEOUT">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.FIELD_OPTION_MAX_TIMEOUT">[docs]</a>
    <span class="n">FIELD_OPTION_MAX_TIMEOUT</span> <span class="o">=</span> <span class="s2">&quot;max_timeout&quot;</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.FIELD_OPTION_CHOICES">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.FIELD_OPTION_CHOICES">[docs]</a>
    <span class="n">FIELD_OPTION_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span>
            <span class="n">FIELD_OPTION_MIN_VALUE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Value must be above&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">FIELD_OPTION_MAX_VALUE</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Value must be below&quot;</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="n">FIELD_OPTION_MAX_TIMEOUT</span><span class="p">,</span>
            <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Last update must not be older than&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.notification_check">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.notification_check">[docs]</a>
    <span class="n">notification_check</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">NotificationCheck</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;definitions&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.metric">[docs]</a>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;notification_checks&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.use_service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.use_service">[docs]</a>
    <span class="n">use_service</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.use_resource">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.use_resource">[docs]</a>
    <span class="n">use_resource</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.use_label">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.use_label">[docs]</a>
    <span class="n">use_label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.use_event_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.use_event_type">[docs]</a>
    <span class="n">use_event_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.field_option">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.field_option">[docs]</a>
    <span class="n">field_option</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">FIELD_OPTION_CHOICES</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">FIELD_OPTION_MIN_VALUE</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.description">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.description">[docs]</a>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.min_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.min_value">[docs]</a>
    <span class="n">min_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.max_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.max_value">[docs]</a>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="NotificationMetricDefinition.steps">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.steps">[docs]</a>
    <span class="n">steps</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationMetricDefinition.unit">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.unit">[docs]</a>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">is_count</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.is_min_val">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.is_min_val">[docs]</a>
    <span class="k">def</span> <span class="nf">is_min_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_option</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">FIELD_OPTION_MIN_VALUE</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.is_max_val">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.is_max_val">[docs]</a>
    <span class="k">def</span> <span class="nf">is_max_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_option</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">FIELD_OPTION_MAX_VALUE</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.is_max_timeout">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.is_max_timeout">[docs]</a>
    <span class="k">def</span> <span class="nf">is_max_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_option</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">FIELD_OPTION_MAX_TIMEOUT</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationMetricDefinition.steps_calculated">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.steps_calculated">[docs]</a>
    <span class="k">def</span> <span class="nf">steps_calculated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.3g}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">NotificationCheck</span><span class="o">.</span><span class="n">get_steps</span><span class="p">(</span><span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">steps</span><span class="p">)]</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationMetricDefinition.is_enabled">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.is_enabled">[docs]</a>
    <span class="k">def</span> <span class="nf">is_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationMetricDefinition.current_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.current_value">[docs]</a>
    <span class="k">def</span> <span class="nf">current_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_check</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_option</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
                <span class="n">val_</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val_</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">val</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">val_</span><span class="p">}</span>
        <span class="k">except</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.get_fields">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.get_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fid_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span>
        <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_calculated</span>

        <span class="k">if</span> <span class="n">steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span>
                <span class="n">choices</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">(</span>
                        <span class="n">v</span><span class="p">,</span>
                        <span class="n">v</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">steps</span>
                <span class="p">],</span>
                <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">max_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fargs</span><span class="p">[</span><span class="s2">&quot;max_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_</span>
            <span class="k">if</span> <span class="n">min_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fargs</span><span class="p">[</span><span class="s2">&quot;min_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">fargs</span><span class="p">)</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fid_base</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="NotificationMetricDefinition.field_name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.field_name">[docs]</a>
    <span class="k">def</span> <span class="nf">field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_option</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="NotificationMetricDefinition.populate_min_max">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.NotificationMetricDefinition.populate_min_max">[docs]</a>
    <span class="k">def</span> <span class="nf">populate_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">notification</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_check</span>
        <span class="n">uthreshold</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">get_user_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="n">uthreshold</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">uthreshold</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">uthreshold</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_check</span>
        <span class="k">except</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mcheck</span> <span class="o">=</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">notification_check</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">notification_check</span><span class="p">,</span>
                    <span class="n">metric</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field_option</span><span class="si">}</span><span class="s2">__isnull&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">mcheck</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metric_check</span> <span class="o">=</span> <span class="n">mcheck</span>
            <span class="k">except</span> <span class="n">MetricNotificationCheck</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="MetricNotificationCheck">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck">[docs]</a>
<span class="k">class</span> <span class="nc">MetricNotificationCheck</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<div class="viewcode-block" id="MetricNotificationCheck.notification_check">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.notification_check">[docs]</a>
    <span class="n">notification_check</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">NotificationCheck</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;checks&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.metric">[docs]</a>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;checks&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.service">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.service">[docs]</a>
    <span class="n">service</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Service</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;checks&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.resource">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.resource">[docs]</a>
    <span class="n">resource</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">MonitoredResource</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.label">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.label">[docs]</a>
    <span class="n">label</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">MetricLabel</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.event_type">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.event_type">[docs]</a>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">EventType</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.min_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.min_value">[docs]</a>
    <span class="n">min_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.max_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.max_value">[docs]</a>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.max_timeout">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.max_timeout">[docs]</a>
    <span class="n">max_timeout</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DurationField</span><span class="p">(</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Max timeout for given metric before error should be raised&quot;</span><span class="p">)</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.active">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.active">[docs]</a>
    <span class="n">active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetricNotificationCheck.definition">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.definition">[docs]</a>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span>
        <span class="n">NotificationMetricDefinition</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;metric_check&quot;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="MetricNotificationCheck.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indicator</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indicator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value above </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indicator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value below </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indicator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;value must be collected within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">indicator</span> <span class="o">=</span> <span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MetricCheck(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">)&quot;</span></div>


    <span class="nd">@property</span>
<div class="viewcode-block" id="MetricNotificationCheck.field_option">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.field_option">[docs]</a>
    <span class="k">def</span> <span class="nf">field_option</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field_option</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">:</span>
            <span class="n">field_option</span> <span class="o">=</span> <span class="s2">&quot;min_value&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">:</span>
            <span class="n">field_option</span> <span class="o">=</span> <span class="s2">&quot;max_value&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span><span class="p">:</span>
            <span class="n">field_option</span> <span class="o">=</span> <span class="s2">&quot;max_timeout&quot;</span>

        <span class="k">if</span> <span class="n">field_option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot establish field_option value&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">field_option</span></div>


<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError">[docs]</a>
    <span class="k">class</span> <span class="nc">MetricValueError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">offending_value</span><span class="p">,</span> <span class="n">threshold_value</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.metric">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.check">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.check">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">check</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.message">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.message">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.name">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.name">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">service_metric</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="s2">&quot;service_metric&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.offending_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.offending_value">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">offending_value</span> <span class="o">=</span> <span class="n">offending_value</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.threshold_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.threshold_value">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold_value</span> <span class="o">=</span> <span class="n">threshold_value</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.severity">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.severity">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">severity</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">notification_check</span><span class="o">.</span><span class="n">severity</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="s2">&quot;notification_check&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.check_url">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.check_url">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_url</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">notification_check</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="s2">&quot;notification_check&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.check_id">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.check_id">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_id</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">notification_check</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">check</span><span class="p">,</span> <span class="s2">&quot;notification_check&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.spotted_at">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.spotted_at">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">spotted_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.description">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.description">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.valid_from">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.valid_from">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_from</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_from</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="s2">&quot;valid_from&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.valid_to">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.valid_to">[docs]</a>
            <span class="bp">self</span><span class="o">.</span><span class="n">valid_to</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="s2">&quot;valid_to&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="MetricNotificationCheck.MetricValueError.__str__">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.MetricValueError.__str__">[docs]</a>
        <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;MetricValueError(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">severity</span><span class="si">}</span><span class="s2">: metric </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="si">}</span><span class="s2"> misses </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="si">}</span><span class="s2"> check: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">)&quot;</span></div>
</div>


<div class="viewcode-block" id="MetricNotificationCheck.check_value">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.check_value">[docs]</a>
    <span class="k">def</span> <span class="nf">check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">valid_on</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check specific metric if it&#39;s faulty or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">value_num</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">service_metric</span><span class="o">.</span><span class="n">metric</span>
        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span>
        <span class="n">unit_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">is_count</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">had_check</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">:</span>
            <span class="n">def_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">description</span>
            <span class="n">msg_prefix</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">:</span>
                <span class="n">os</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">is_all</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">is_other</span><span class="p">:</span>
                    <span class="n">msg_prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> OWS&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg_prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> OWS&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
                <span class="n">msg_prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> service&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
                <span class="n">msg_prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">] resource&quot;</span><span class="p">)</span>

            <span class="n">msg_prefix</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg_prefix</span><span class="p">)</span>
            <span class="n">description_tmpl</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg_prefix</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> should be </span><span class="se">{{}}</span><span class="s2"> &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">:0.0f</span><span class="se">}}</span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s2">, got </span><span class="se">{{</span><span class="s2">:0.0f</span><span class="se">}}</span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s2"> instead&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">had_check</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">def_msg</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">description</span> <span class="o">=</span> <span class="n">description_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;at least&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">MetricValueError</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">had_check</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">def_msg</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">description</span> <span class="o">=</span> <span class="n">description_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;at most&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">MetricValueError</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">had_check</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># we have to check for now, because valid_on may be in the past,</span>
                <span class="c1"># metric may be at the valid_on point in time</span>
                <span class="n">valid_on</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">valid_on</span> <span class="o">-</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span><span class="p">:</span>
                    <span class="n">total_seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="n">actual_seconds</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid_on</span> <span class="o">-</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">def_msg</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">total_seconds</span><span class="p">)</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
                    <span class="n">description</span> <span class="o">=</span> <span class="n">description_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;recored at most &quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_seconds</span><span class="si">}</span><span class="s2"> seconds ago&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">actual_seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">MetricValueError</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">metric</span><span class="o">.</span><span class="n">valid_to</span><span class="p">,</span> <span class="n">valid_on</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">had_check</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">MetricValueError</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Metric check </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is not checking anything&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetricNotificationCheck.check_metric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.MetricNotificationCheck.check_metric">[docs]</a>
    <span class="k">def</span> <span class="nf">check_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">for_timestamp</span><span class="p">:</span>
            <span class="n">for_timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">qfilter</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">:</span>
            <span class="n">qfilter</span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">qfilter</span><span class="p">[</span><span class="s2">&quot;resource&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="n">qfilter</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">:</span>
            <span class="n">qfilter</span><span class="p">[</span><span class="s2">&quot;event_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">MetricValue</span><span class="o">.</span><span class="n">get_for</span><span class="p">(</span><span class="n">valid_on</span><span class="o">=</span><span class="n">for_timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">qfilter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">MetricValue</span><span class="o">.</span><span class="n">get_for</span><span class="p">(</span><span class="o">**</span><span class="n">qfilter</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">MetricValueError</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Cannot find metric values for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">for_timestamp</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_value</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">for_timestamp</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="BuiltIns">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns">[docs]</a>
<span class="k">class</span> <span class="nc">BuiltIns</span><span class="p">:</span>
<div class="viewcode-block" id="BuiltIns.service_types">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.service_types">[docs]</a>
    <span class="n">service_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_GEONODE</span><span class="p">,</span>
        <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_GEOSERVER</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.host_service_types">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.host_service_types">[docs]</a>
    <span class="n">host_service_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GN</span><span class="p">,</span>
        <span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GS</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.metrics_rate">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.metrics_rate">[docs]</a>
    <span class="n">metrics_rate</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;response.time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.size&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

    <span class="c1"># metrics_count = (&#39;request.count&#39;, &#39;request.method&#39;, &#39;request.</span>

<div class="viewcode-block" id="BuiltIns.geonode_metrics">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.geonode_metrics">[docs]</a>
    <span class="n">geonode_metrics</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;request&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.users&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ua&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.path&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ua.family&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.method&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.error.count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.country&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.region&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.city&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.error.types&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.host_metrics">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.host_metrics">[docs]</a>
    <span class="n">host_metrics</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;load.1m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.5m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.15m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage.percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.buffers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.all&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uptime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage.percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.used&quot;</span><span class="p">,</span>
        <span class="c1"># mountpoint is the label</span>
        <span class="s2">&quot;network.in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out.rate&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.rates">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.rates">[docs]</a>
    <span class="n">rates</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;response.time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.1m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.5m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.15m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage.percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage.percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.used&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.values">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.values">[docs]</a>
    <span class="n">values</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;request.ip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ua&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ua.family&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.path&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.method&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.country&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.region&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.city&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.status&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.ereror.types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.users&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.values_numeric">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.values_numeric">[docs]</a>
    <span class="n">values_numeric</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;storage.total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.used&quot;</span><span class="p">,</span>
        <span class="s2">&quot;storage.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.buffers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.all&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.counters">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.counters">[docs]</a>
    <span class="n">counters</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;request.count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.error.count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uptime&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.unit_seconds">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.unit_seconds">[docs]</a>
    <span class="n">unit_seconds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;response.time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uptime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cpu.usage&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.unit_bytes">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.unit_bytes">[docs]</a>
    <span class="n">unit_bytes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;response.size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.free&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.buffers&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.all&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.unit_bps">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.unit_bps">[docs]</a>
    <span class="n">unit_bps</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;network.in.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out.rate&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.unit_rate">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.unit_rate">[docs]</a>
    <span class="n">unit_rate</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;cpu.usage.rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.1m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.5m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;load.15m&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>

<div class="viewcode-block" id="BuiltIns.unit_percentage">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.unit_percentage">[docs]</a>
    <span class="n">unit_percentage</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;cpu.usage.percent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mem.usage.percent&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="BuiltIns.descriptions">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.BuiltIns.descriptions">[docs]</a>
    <span class="n">descriptions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;request.count&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of requests&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.users&quot;</span><span class="p">:</span> <span class="s2">&quot;Number of users visiting&quot;</span><span class="p">,</span>
        <span class="s2">&quot;response.time&quot;</span><span class="p">:</span> <span class="s2">&quot;Time of making a response&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ip&quot;</span><span class="p">:</span> <span class="s2">&quot;IP Address of source of request&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.ua&quot;</span><span class="p">:</span> <span class="s2">&quot;User Agent of source of request&quot;</span><span class="p">,</span>
        <span class="s2">&quot;request.path&quot;</span><span class="p">:</span> <span class="s2">&quot;Request URL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in.rate&quot;</span><span class="p">:</span> <span class="s2">&quot;Network incoming traffic rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out.rate&quot;</span><span class="p">:</span> <span class="s2">&quot;Network outgoing traffic rate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.out&quot;</span><span class="p">:</span> <span class="s2">&quot;Network outgoing traffic bytes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;network.in&quot;</span><span class="p">:</span> <span class="s2">&quot;Network incoming traffic bytes&quot;</span><span class="p">,</span>
    <span class="p">}</span></div>
</div>



<div class="viewcode-block" id="populate">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.populate">[docs]</a>
<span class="k">def</span> <span class="nf">populate</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">geonode_metrics</span> <span class="o">+</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">host_metrics</span><span class="p">:</span>
        <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">service_types</span> <span class="o">+</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">host_service_types</span><span class="p">:</span>
        <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">st</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">service_types</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">geonode_metrics</span><span class="p">:</span>
            <span class="n">_st</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">st</span><span class="p">)</span>
            <span class="n">_m</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
            <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">service_type</span><span class="o">=</span><span class="n">_st</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">_m</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">host_service_types</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">host_metrics</span><span class="p">:</span>
            <span class="n">_st</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">st</span><span class="p">)</span>
            <span class="n">_m</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
            <span class="n">ServiceTypeMetric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">service_type</span><span class="o">=</span><span class="n">_st</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">_m</span><span class="p">)</span>
    <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__in</span><span class="o">=</span><span class="n">BuiltIns</span><span class="o">.</span><span class="n">counters</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Metric</span><span class="o">.</span><span class="n">TYPE_COUNT</span><span class="p">)</span>
    <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__in</span><span class="o">=</span><span class="n">BuiltIns</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Metric</span><span class="o">.</span><span class="n">TYPE_RATE</span><span class="p">)</span>
    <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__in</span><span class="o">=</span><span class="n">BuiltIns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Metric</span><span class="o">.</span><span class="n">TYPE_VALUE</span><span class="p">)</span>
    <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__in</span><span class="o">=</span><span class="n">BuiltIns</span><span class="o">.</span><span class="n">values_numeric</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Metric</span><span class="o">.</span><span class="n">TYPE_VALUE_NUMERIC</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">etype</span><span class="p">,</span> <span class="n">etype_name</span> <span class="ow">in</span> <span class="n">EventType</span><span class="o">.</span><span class="n">EVENT_TYPES</span><span class="p">:</span>
        <span class="n">EventType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">etype</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">BuiltIns</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unit_&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">BuiltIns</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">attr_name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">mname</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">mname</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">uname</span>
            <span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">unit__isnull</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">Metric</span><span class="o">.</span><span class="n">UNIT_COUNT</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">BuiltIns</span><span class="o">.</span><span class="n">descriptions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">Metric</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">metric</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">do_autoconfigure</span><span class="p">()</span></div>



<div class="viewcode-block" id="do_autoconfigure">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.do_autoconfigure">[docs]</a>
<span class="k">def</span> <span class="nf">do_autoconfigure</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create configuration from geonode&#39;s settings:</span>
<span class="sd">     * extract all hosts</span>
<span class="sd">     * create geonode instances</span>
<span class="sd">      * create host-geonode instances (favor this instead of geoserver)</span>

<span class="sd">     * create geoserver instances</span>
<span class="sd">      * create host-geoserver instances if needed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get list of services</span>
    <span class="n">wsite</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">)</span>
    <span class="c1"># default host</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_host_by_name</span> <span class="o">=</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="n">wsite</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">_host_by_name</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span>
            <span class="n">wsite</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
            <span class="n">_host_by_name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># default geonode</span>
    <span class="n">geonode_name</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">MONITORING_SERVICE_NAME</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wsite</span><span class="o">.</span><span class="n">hostname</span><span class="si">}</span><span class="s2">-geonode&quot;</span>
    <span class="n">geonodes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">geonode_name</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span><span class="p">,</span> <span class="n">hosts</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

    <span class="n">geoservers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">OGC_SERVER</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;BACKEND&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;geonode.geoserver&quot;</span><span class="p">:</span>
            <span class="n">gname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">-geoserver&quot;</span>
            <span class="n">gsite</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;LOCATION&quot;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_host_by_name</span> <span class="o">=</span> <span class="n">gethostbyname</span><span class="p">(</span><span class="n">gsite</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">_host_by_name</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
            <span class="n">ghost</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gsite</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                <span class="n">_host_by_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ghost</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
                <span class="n">hosts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ghost</span><span class="p">)</span>
            <span class="n">geoservers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">gname</span><span class="p">,</span>
                    <span class="n">val</span><span class="p">[</span><span class="s2">&quot;LOCATION&quot;</span><span class="p">],</span>
                    <span class="n">ghost</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">hosts_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">host</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># if h.ip != host[1]:</span>
            <span class="c1">#     log.warning(&quot;Different ip. got&quot;, h.ip, &quot;instead of&quot;, host[1])</span>
        <span class="k">except</span> <span class="n">Host</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">host</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ip</span><span class="o">=</span><span class="n">host</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">hosts_map</span><span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>

    <span class="n">geonode_type</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_GEONODE</span><span class="p">)</span>
    <span class="n">geoserver_type</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_GEOSERVER</span><span class="p">)</span>

    <span class="n">hostgeonode_type</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GN</span><span class="p">)</span>
    <span class="n">hostgeoserver_type</span> <span class="o">=</span> <span class="n">ServiceType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">ServiceType</span><span class="o">.</span><span class="n">TYPE_HOST_GS</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">geonode</span> <span class="ow">in</span> <span class="n">geonodes</span><span class="p">:</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">geonode</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">host_ip</span> <span class="o">=</span> <span class="n">geonode</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">hosts_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host_name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">host_name</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">host_ip</span><span class="p">)</span>
        <span class="n">host</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">geonode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">Service</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">geonode</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="n">geonode</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="n">geonode_type</span><span class="p">)</span>
        <span class="n">service</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">shost_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-hostgeonode&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">shost_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Service</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="n">hostgeonode_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">geonode</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">shost_name</span><span class="p">)</span>
        <span class="n">service</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">geoserver</span> <span class="ow">in</span> <span class="n">geoservers</span><span class="p">:</span>
        <span class="n">host_name</span> <span class="o">=</span> <span class="n">geoserver</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">host_ip</span> <span class="o">=</span> <span class="n">geoserver</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">hosts_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">host_name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Host</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">host_name</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">host_ip</span><span class="p">)</span>
        <span class="n">host</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">geoserver</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">Service</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">geoserver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="n">geoserver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="n">geoserver_type</span>
            <span class="p">)</span>
        <span class="n">service</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">shost_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-hostgeoserver&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">shost_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Service</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">service</span> <span class="o">=</span> <span class="n">Service</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">service_type</span><span class="o">=</span><span class="n">hostgeoserver_type</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">geoserver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">shost_name</span>
            <span class="p">)</span>
        <span class="n">service</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="n">do_reload</span><span class="p">()</span></div>



<div class="viewcode-block" id="do_reload">
<a class="viewcode-back" href="../../../autoapi/geonode/monitoring/models/index.html#geonode.monitoring.models.do_reload">[docs]</a>
<span class="k">def</span> <span class="nf">do_reload</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will reload uwsgi if it&#39;s available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">uwsgi</span>

        <span class="n">uwsgi</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kan Territory &amp; IT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>