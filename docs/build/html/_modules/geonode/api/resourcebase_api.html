

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>geonode.api.resourcebase_api &mdash; GeoNode Cloud Core 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            GeoNode Cloud Core
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenido</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GeoNode Cloud Core</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../geonode.html">geonode</a></li>
          <li class="breadcrumb-item"><a href="../api.html">geonode.api</a></li>
      <li class="breadcrumb-item active">geonode.api.resourcebase_api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for geonode.api.resourcebase_api</h1><div class="highlight"><pre>
<span></span><span class="c1">#########################################################################</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2016 OSGeo</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1">#########################################################################</span>
<span class="kn">from</span> <span class="nn">geonode.base.enumerations</span> <span class="kn">import</span> <span class="n">LAYER_TYPES</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">tastypie.authentication</span> <span class="kn">import</span> <span class="n">MultiAuthentication</span><span class="p">,</span> <span class="n">SessionAuthentication</span>
<span class="kn">from</span> <span class="nn">tastypie.bundle</span> <span class="kn">import</span> <span class="n">Bundle</span>

<span class="kn">from</span> <span class="nn">tastypie.constants</span> <span class="kn">import</span> <span class="n">ALL</span><span class="p">,</span> <span class="n">ALL_WITH_RELATIONS</span>
<span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">tastypie.utils</span> <span class="kn">import</span> <span class="n">trailing_slash</span>

<span class="kn">from</span> <span class="nn">guardian.shortcuts</span> <span class="kn">import</span> <span class="n">get_objects_for_user</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">InvalidPage</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>

<span class="kn">from</span> <span class="nn">tastypie.utils.mime</span> <span class="kn">import</span> <span class="n">build_content_type</span>

<span class="kn">from</span> <span class="nn">geonode</span> <span class="kn">import</span> <span class="n">get_version</span><span class="p">,</span> <span class="n">geoserver</span>
<span class="kn">from</span> <span class="nn">geonode.layers.models</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">geonode.maps.models</span> <span class="kn">import</span> <span class="n">Map</span>
<span class="kn">from</span> <span class="nn">geonode.geoapps.models</span> <span class="kn">import</span> <span class="n">GeoApp</span>
<span class="kn">from</span> <span class="nn">geonode.documents.models</span> <span class="kn">import</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">geonode.base.models</span> <span class="kn">import</span> <span class="n">ResourceBase</span>
<span class="kn">from</span> <span class="nn">geonode.base.models</span> <span class="kn">import</span> <span class="n">HierarchicalKeyword</span>
<span class="kn">from</span> <span class="nn">geonode.base.bbox_utils</span> <span class="kn">import</span> <span class="n">filter_bbox</span>
<span class="kn">from</span> <span class="nn">geonode.groups.models</span> <span class="kn">import</span> <span class="n">GroupProfile</span>
<span class="kn">from</span> <span class="nn">geonode.utils</span> <span class="kn">import</span> <span class="n">check_ogc_backend</span>
<span class="kn">from</span> <span class="nn">geonode.security.utils</span> <span class="kn">import</span> <span class="n">get_visible_resources</span>
<span class="kn">from</span> <span class="nn">.authentication</span> <span class="kn">import</span> <span class="n">OAuthAuthentication</span>
<span class="kn">from</span> <span class="nn">.authorization</span> <span class="kn">import</span> <span class="n">GeoNodeAuthorization</span><span class="p">,</span> <span class="n">GeonodeApiKeyAuthentication</span>

<span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TagResource</span><span class="p">,</span>
    <span class="n">RegionResource</span><span class="p">,</span>
    <span class="n">OwnersResource</span><span class="p">,</span>
    <span class="n">ThesaurusKeywordResource</span><span class="p">,</span>
    <span class="n">TopicCategoryResource</span><span class="p">,</span>
    <span class="n">GroupResource</span><span class="p">,</span>
    <span class="n">FILTER_TYPES</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.paginator</span> <span class="kn">import</span> <span class="n">CrossSiteXHRPaginator</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">HAYSTACK_SEARCH</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">haystack.query</span> <span class="kn">import</span> <span class="n">SearchQuerySet</span>  <span class="c1"># noqa</span>

<div class="viewcode-block" id="logger">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.logger">[docs]</a>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>



<div class="viewcode-block" id="CommonMetaApi">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi">[docs]</a>
<span class="k">class</span> <span class="nc">CommonMetaApi</span><span class="p">:</span>
<div class="viewcode-block" id="CommonMetaApi.authorization">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi.authorization">[docs]</a>
    <span class="n">authorization</span> <span class="o">=</span> <span class="n">GeoNodeAuthorization</span><span class="p">()</span></div>

<div class="viewcode-block" id="CommonMetaApi.allowed_methods">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi.allowed_methods">[docs]</a>
    <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CommonMetaApi.filtering">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi.filtering">[docs]</a>
    <span class="n">filtering</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="s2">&quot;keywords&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;tkeywords&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;regions&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="s2">&quot;purpose&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
        <span class="s2">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">ALL_WITH_RELATIONS</span><span class="p">,</span>
    <span class="p">}</span></div>

<div class="viewcode-block" id="CommonMetaApi.ordering">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi.ordering">[docs]</a>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;popular_count&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CommonMetaApi.max_limit">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonMetaApi.max_limit">[docs]</a>
    <span class="n">max_limit</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="CommonModelApi">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi">[docs]</a>
<span class="k">class</span> <span class="nc">CommonModelApi</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
<div class="viewcode-block" id="CommonModelApi.keywords">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.keywords">[docs]</a>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="n">TagResource</span><span class="p">,</span> <span class="s2">&quot;keywords&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.regions">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.regions">[docs]</a>
    <span class="n">regions</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="n">RegionResource</span><span class="p">,</span> <span class="s2">&quot;regions&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.category">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.category">[docs]</a>
    <span class="n">category</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToOneField</span><span class="p">(</span><span class="n">TopicCategoryResource</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.group">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.group">[docs]</a>
    <span class="n">group</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToOneField</span><span class="p">(</span><span class="n">GroupResource</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.owner">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.owner">[docs]</a>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToOneField</span><span class="p">(</span><span class="n">OwnersResource</span><span class="p">,</span> <span class="s2">&quot;owner&quot;</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.tkeywords">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.tkeywords">[docs]</a>
    <span class="n">tkeywords</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="n">ThesaurusKeywordResource</span><span class="p">,</span> <span class="s2">&quot;tkeywords&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CommonModelApi.VALUES">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.VALUES">[docs]</a>
    <span class="n">VALUES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># fields in the db</span>
        <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;typename&quot;</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;edition&quot;</span><span class="p">,</span>
        <span class="s2">&quot;purpose&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maintenance_frequency&quot;</span><span class="p">,</span>
        <span class="s2">&quot;restriction_code_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;constraints_other&quot;</span><span class="p">,</span>
        <span class="s2">&quot;license&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spatial_representation_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temporal_extent_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temporal_extent_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data_quality_statement&quot;</span><span class="p">,</span>
        <span class="s2">&quot;abstract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csw_wkt_geometry&quot;</span><span class="p">,</span>
        <span class="s2">&quot;csw_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;owner__username&quot;</span><span class="p">,</span>
        <span class="s2">&quot;share_count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;popular_count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;srid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bbox_polygon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category__gn_description&quot;</span><span class="p">,</span>
        <span class="s2">&quot;supplemental_information&quot;</span><span class="p">,</span>
        <span class="s2">&quot;site_url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thumbnail_url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;detail_url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rating&quot;</span><span class="p">,</span>
        <span class="s2">&quot;group__name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;has_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_approved&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_published&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dirty_state&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_only&quot;</span><span class="p">,</span>
    <span class="p">]</span></div>


<div class="viewcode-block" id="CommonModelApi.build_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.build_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_bad_filters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="n">ignore_bad_filters</span><span class="o">=</span><span class="n">ignore_bad_filters</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;type__in&quot;</span> <span class="ow">in</span> <span class="n">filters</span> <span class="ow">and</span> <span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">&quot;type__in&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">FILTER_TYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;type__in&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">LAYER_TYPES</span><span class="p">):</span>
            <span class="n">orm_filters</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;type__in&quot;</span><span class="p">)})</span>
        <span class="k">if</span> <span class="s2">&quot;app_type__in&quot;</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">orm_filters</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;app_type__in&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()})</span>

        <span class="n">_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;metadata__</span><span class="si">{</span><span class="n">_k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">_v</span> <span class="k">for</span> <span class="n">_k</span><span class="p">,</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">_k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;metadata__&quot;</span><span class="p">)}</span>
        <span class="k">if</span> <span class="n">_metadata</span><span class="p">:</span>
            <span class="n">orm_filters</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;metadata_filters&quot;</span><span class="p">:</span> <span class="n">_metadata</span><span class="p">})</span>

        <span class="k">if</span> <span class="s2">&quot;extent&quot;</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">orm_filters</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;extent&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;extent&quot;</span><span class="p">]})</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s2">&quot;f_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;f_method&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;f_method&quot;</span> <span class="ow">in</span> <span class="n">filters</span> <span class="k">else</span> <span class="s2">&quot;and&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">SEARCH_RESOURCES_EXTENDED</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_additional_filters</span><span class="p">(</span><span class="n">orm_filters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orm_filters</span></div>


<div class="viewcode-block" id="CommonModelApi._remove_additional_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi._remove_additional_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">_remove_additional_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orm_filters</span><span class="p">):</span>
        <span class="n">orm_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;abstract__icontains&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">orm_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;purpose__icontains&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">orm_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;f_method&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orm_filters</span></div>


<div class="viewcode-block" id="CommonModelApi.apply_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.apply_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">applicable_filters</span><span class="p">):</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;keywords__slug__in&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">metadata_only</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">filtering_method</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;f_method&quot;</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">)</span>
        <span class="n">metadata_filters</span> <span class="o">=</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_filters&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filtering_method</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">Q</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">applicable_filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">filters</span> <span class="o">|=</span> <span class="n">Q</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">semi_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">semi_filtered</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">apply_filters</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">applicable_filters</span><span class="p">)</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">the_type</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">the_type</span> <span class="ow">in</span> <span class="n">LAYER_TYPES</span><span class="p">:</span>
                    <span class="n">super_type</span> <span class="o">=</span> <span class="n">the_type</span>
                    <span class="k">if</span> <span class="s2">&quot;vector_time&quot;</span> <span class="o">==</span> <span class="n">the_type</span><span class="p">:</span>
                        <span class="n">super_type</span> <span class="o">=</span> <span class="s2">&quot;vector&quot;</span>
                    <span class="k">if</span> <span class="n">filtered</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">the_type</span><span class="p">:</span>
                            <span class="n">filtered</span> <span class="o">=</span> <span class="n">filtered</span> <span class="o">|</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Layer___subtype</span><span class="o">=</span><span class="n">super_type</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                                <span class="n">Layer___has_time</span><span class="o">=</span><span class="kc">False</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">filtered</span> <span class="o">=</span> <span class="n">filtered</span> <span class="o">|</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Layer___subtype</span><span class="o">=</span><span class="n">super_type</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">the_type</span><span class="p">:</span>
                            <span class="n">filtered</span> <span class="o">=</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Layer___subtype</span><span class="o">=</span><span class="n">super_type</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">Layer___has_time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">filtered</span> <span class="o">=</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Layer___subtype</span><span class="o">=</span><span class="n">super_type</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_type_filter</span> <span class="o">=</span> <span class="n">FILTER_TYPES</span><span class="p">[</span><span class="n">the_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">filtered</span><span class="p">:</span>
                        <span class="n">filtered</span> <span class="o">=</span> <span class="n">filtered</span> <span class="o">|</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">polymorphic_ctype__model</span><span class="o">=</span><span class="n">_type_filter</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">filtered</span> <span class="o">=</span> <span class="n">semi_filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">polymorphic_ctype__model</span><span class="o">=</span><span class="n">_type_filter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">semi_filtered</span>

        <span class="k">if</span> <span class="n">extent</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">filter_bbox</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">extent</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_h_keywords</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metadata_filters</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">**</span><span class="n">metadata_filters</span><span class="p">)</span>

        <span class="c1"># return filtered</span>
        <span class="k">return</span> <span class="n">get_visible_resources</span><span class="p">(</span>
            <span class="n">filtered</span><span class="p">,</span>
            <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">metadata_only</span><span class="o">=</span><span class="n">metadata_only</span><span class="p">,</span>
            <span class="n">admin_approval_required</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">ADMIN_MODERATE_UPLOADS</span><span class="p">,</span>
            <span class="n">unpublished_not_visible</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">RESOURCE_PUBLISHING</span><span class="p">,</span>
            <span class="n">private_groups_not_visibile</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">GROUP_PRIVATE_RESOURCES</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CommonModelApi.filter_h_keywords">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.filter_h_keywords">[docs]</a>
    <span class="k">def</span> <span class="nf">filter_h_keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">keywords</span><span class="p">):</span>
        <span class="n">treeqs</span> <span class="o">=</span> <span class="n">HierarchicalKeyword</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">keywords</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">kws</span> <span class="o">=</span> <span class="n">HierarchicalKeyword</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="n">keyword</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">slug__iexact</span><span class="o">=</span><span class="n">keyword</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
                        <span class="n">treeqs</span> <span class="o">=</span> <span class="n">treeqs</span> <span class="o">|</span> <span class="n">HierarchicalKeyword</span><span class="o">.</span><span class="n">get_tree</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
                    <span class="c1"># Ignore keywords not actually used?</span>
                    <span class="k">pass</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">keywords__in</span><span class="o">=</span><span class="n">treeqs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">queryset</span>
        <span class="k">return</span> <span class="n">filtered</span></div>


<div class="viewcode-block" id="CommonModelApi.build_haystack_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.build_haystack_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">build_haystack_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">haystack.inputs</span> <span class="kn">import</span> <span class="n">Raw</span>
        <span class="kn">from</span> <span class="nn">haystack.query</span> <span class="kn">import</span> <span class="n">SearchQuerySet</span><span class="p">,</span> <span class="n">SQ</span>  <span class="c1"># noqa</span>

        <span class="n">sqs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Retrieve Query Params</span>

        <span class="c1"># Text search</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Types and subtypes to filter (map, layer, vector, etc)</span>
        <span class="n">type_facets</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;type__in&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># If coming from explore page, add type filter from resource_name</span>
        <span class="n">resource_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource_filter</span> <span class="o">!=</span> <span class="s2">&quot;base&quot;</span> <span class="ow">and</span> <span class="n">resource_filter</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_facets</span><span class="p">:</span>
            <span class="n">type_facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resource_filter</span><span class="p">)</span>

        <span class="c1"># Publication date range (start,end)</span>
        <span class="n">date_end</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date__lte&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">date_start</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date__gte&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Topic category filter</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;category__identifier__in&quot;</span><span class="p">)</span>

        <span class="c1"># Keyword filter</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;keywords__slug__in&quot;</span><span class="p">)</span>

        <span class="c1"># Region filter</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;regions__name__in&quot;</span><span class="p">)</span>

        <span class="c1"># Owner filters</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s2">&quot;owner__username__in&quot;</span><span class="p">)</span>

        <span class="c1"># Sort order</span>
        <span class="n">sort</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;order_by&quot;</span><span class="p">,</span> <span class="s2">&quot;relevance&quot;</span><span class="p">)</span>

        <span class="c1"># Geospatial Elements</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Filter by Type and subtype</span>
        <span class="k">if</span> <span class="n">type_facets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">subtypes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">type_facets</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">,</span> <span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">}:</span>
                    <span class="c1"># Type is one of our Major Types (not a sub type)</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">LAYER_TYPES</span><span class="p">:</span>
                    <span class="n">subtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;vector&quot;</span> <span class="ow">in</span> <span class="n">subtypes</span> <span class="ow">and</span> <span class="s2">&quot;vector_time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
                <span class="n">subtypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;vector_time&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtypes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">)</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="n">SearchQuerySet</span><span class="p">()</span><span class="o">.</span><span class="n">narrow</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subtype:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">subtypes</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">narrow</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;type:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Filter by Query Params</span>
        <span class="c1"># haystack bug? if boosted fields aren&#39;t included in the</span>
        <span class="c1"># query, then the score won&#39;t be affected by the boost</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">query</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">):</span>
                <span class="c1"># Match exact phrase</span>
                <span class="n">phrase</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="n">SQ</span><span class="p">(</span><span class="n">title__exact</span><span class="o">=</span><span class="n">phrase</span><span class="p">)</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">description__exact</span><span class="o">=</span><span class="n">phrase</span><span class="p">)</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">content__exact</span><span class="o">=</span><span class="n">phrase</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\W&quot;</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">)</span> <span class="k">if</span> <span class="n">w</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">search_word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">SQ</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">search_word</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;AND&quot;</span><span class="p">,</span> <span class="s2">&quot;OR&quot;</span><span class="p">}:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;OR&quot;</span><span class="p">:</span>  <span class="c1"># previous word OR this word</span>
                        <span class="n">sqs</span> <span class="o">=</span> <span class="n">sqs</span><span class="o">.</span><span class="n">filter_or</span><span class="p">(</span>
                            <span class="n">SQ</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># previous word AND this word</span>
                        <span class="n">sqs</span> <span class="o">=</span> <span class="n">sqs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                            <span class="n">SQ</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span> <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">Raw</span><span class="p">(</span><span class="n">search_word</span><span class="p">))</span>
                        <span class="p">)</span>

        <span class="c1"># filter by category</span>
        <span class="k">if</span> <span class="n">category</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">narrow</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;category:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># filter by keyword: use filter_or with keywords_exact</span>
        <span class="c1"># not using exact leads to fuzzy matching and too many results</span>
        <span class="c1"># using narrow with exact leads to zero results if multiple keywords</span>
        <span class="c1"># selected</span>
        <span class="k">if</span> <span class="n">keywords</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter_or</span><span class="p">(</span><span class="n">keywords_exact</span><span class="o">=</span><span class="n">keyword</span><span class="p">)</span>

        <span class="c1"># filter by regions: use filter_or with regions_exact</span>
        <span class="c1"># not using exact leads to fuzzy matching and too many results</span>
        <span class="c1"># using narrow with exact leads to zero results if multiple keywords</span>
        <span class="c1"># selected</span>
        <span class="k">if</span> <span class="n">regions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter_or</span><span class="p">(</span><span class="n">regions_exact__exact</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>

        <span class="c1"># filter by owner</span>
        <span class="k">if</span> <span class="n">owner</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">narrow</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;owner__username:</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">owner</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># filter by date</span>
        <span class="k">if</span> <span class="n">date_start</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">SQ</span><span class="p">(</span><span class="n">date__gte</span><span class="o">=</span><span class="n">date_start</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">date_end</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">SQ</span><span class="p">(</span><span class="n">date__lte</span><span class="o">=</span><span class="n">date_end</span><span class="p">))</span>

        <span class="c1"># Filter by geographic bounding box</span>
        <span class="k">if</span> <span class="n">bbox</span><span class="p">:</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span>
                <span class="n">SQ</span><span class="p">(</span><span class="n">bbox_top__lte</span><span class="o">=</span><span class="n">bottom</span><span class="p">)</span>
                <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">bbox_bottom__gte</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
                <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">bbox_left__gte</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>
                <span class="o">|</span> <span class="n">SQ</span><span class="p">(</span><span class="n">bbox_right__lte</span><span class="o">=</span><span class="n">left</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Apply sort</span>
        <span class="k">if</span> <span class="n">sort</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-date&quot;</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sort</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sort</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;title&quot;</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;title_sortable&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sort</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-title&quot;</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-title_sortable&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">sort</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-popular_count&quot;</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-popular_count&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchQuerySet</span><span class="p">()</span> <span class="k">if</span> <span class="n">sqs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sqs</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sqs</span></div>


<div class="viewcode-block" id="CommonModelApi.get_search">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.get_search">[docs]</a>
    <span class="k">def</span> <span class="nf">get_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_check</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throttle_check</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># Get the list of objects that matches the filter</span>
        <span class="n">sqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_haystack_filters</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">SKIP_PERMS_FILTER</span><span class="p">:</span>
            <span class="n">filter_set</span> <span class="o">=</span> <span class="n">get_objects_for_user</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;base.view_resourcebase&quot;</span><span class="p">)</span>

            <span class="n">filter_set</span> <span class="o">=</span> <span class="n">get_visible_resources</span><span class="p">(</span>
                <span class="n">filter_set</span><span class="p">,</span>
                <span class="n">request</span><span class="o">.</span><span class="n">user</span> <span class="k">if</span> <span class="n">request</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">admin_approval_required</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">ADMIN_MODERATE_UPLOADS</span><span class="p">,</span>
                <span class="n">unpublished_not_visible</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">RESOURCE_PUBLISHING</span><span class="p">,</span>
                <span class="n">private_groups_not_visibile</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">GROUP_PRIVATE_RESOURCES</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">filter_set_ids</span> <span class="o">=</span> <span class="n">filter_set</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="c1"># Do the query using the filterset and the query term. Facet the</span>
            <span class="c1"># results</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filter_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">sqs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">filter_set_ids</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;subtype&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;regions&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sqs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sqs</span> <span class="o">=</span> <span class="n">sqs</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;subtype&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;regions&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">facet</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sqs</span><span class="p">:</span>
            <span class="c1"># Build the Facet dict</span>
            <span class="n">facets</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">facet</span> <span class="ow">in</span> <span class="n">sqs</span><span class="o">.</span><span class="n">facet_counts</span><span class="p">()[</span><span class="s2">&quot;fields&quot;</span><span class="p">]:</span>
                <span class="n">facets</span><span class="p">[</span><span class="n">facet</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sqs</span><span class="o">.</span><span class="n">facet_counts</span><span class="p">()[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="n">facet</span><span class="p">]:</span>
                    <span class="n">facets</span><span class="p">[</span><span class="n">facet</span><span class="p">][</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Paginate the results</span>
            <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">sqs</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;offset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">InvalidPage</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Http404</span><span class="p">(</span><span class="s2">&quot;Sorry, no results on that page.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">has_previous</span><span class="p">():</span>
                <span class="n">previous_page</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">previous_page_number</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">previous_page</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">page</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
                <span class="n">next_page</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">next_page_number</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_page</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">total_count</span> <span class="o">=</span> <span class="n">sqs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">object_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_page</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">previous_page</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">total_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">facets</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">object_list</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">CLIENT_RESULTS_LIMIT</span><span class="p">,</span>
                <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="n">next_page</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="s2">&quot;previous&quot;</span><span class="p">:</span> <span class="n">previous_page</span><span class="p">,</span>
                <span class="s2">&quot;total_count&quot;</span><span class="p">:</span> <span class="n">total_count</span><span class="p">,</span>
                <span class="s2">&quot;facets&quot;</span><span class="p">:</span> <span class="n">facets</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;objects&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_haystack_api_fields</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_throttled_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">object_list</span><span class="p">)</span></div>


<div class="viewcode-block" id="CommonModelApi.get_haystack_api_fields">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.get_haystack_api_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">get_haystack_api_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">haystack_object</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">haystack_object</span><span class="o">.</span><span class="n">get_stored_fields</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;_exact$|_sortable$&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)}</span></div>


<div class="viewcode-block" id="CommonModelApi.get_list">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.get_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a serialized list of resources.</span>

<span class="sd">        Calls ``obj_get_list`` to provide the data, then handles that result</span>
<span class="sd">        set and serializes it.</span>

<span class="sd">        Should return a HttpResponse (200 OK).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Uncached for now. Invalidation that works for everyone may be</span>
        <span class="c1"># impossible.</span>
        <span class="n">base_bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_get_list</span><span class="p">(</span><span class="n">bundle</span><span class="o">=</span><span class="n">base_bundle</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_api_resource_names</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">sorted_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_sorting</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>

        <span class="n">paginator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">paginator_class</span><span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span>
            <span class="n">sorted_objects</span><span class="p">,</span>
            <span class="n">resource_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(),</span>
            <span class="n">limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">max_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">max_limit</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">collection_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">()</span>

        <span class="n">to_be_serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alter_list_data_to_serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">to_be_serialized</span><span class="p">,</span> <span class="n">response_objects</span><span class="o">=</span><span class="n">objects</span><span class="p">)</span></div>


<div class="viewcode-block" id="CommonModelApi.format_objects">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.format_objects">[docs]</a>
    <span class="k">def</span> <span class="nf">format_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format the objects for output in a response.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;site_url&quot;</span><span class="p">,</span> <span class="s2">&quot;has_time&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># hack needed because dehydrate does not seem to work in CommonModelApi</span>
        <span class="n">formatted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="n">formatted_obj</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;site_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatted_obj</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner__username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">username</span>

            <span class="k">if</span> <span class="n">formatted_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_to_dict</span><span class="p">(</span><span class="n">_m</span><span class="p">)</span> <span class="k">for</span> <span class="n">_m</span> <span class="ow">in</span> <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]]</span>

            <span class="n">formatted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">formatted_objects</span></div>


<div class="viewcode-block" id="CommonModelApi.create_response">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.create_response">[docs]</a>
    <span class="k">def</span> <span class="nf">create_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response_class</span><span class="o">=</span><span class="n">HttpResponse</span><span class="p">,</span> <span class="n">response_objects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the common &quot;which-format/serialize/return-response&quot; cycle.</span>

<span class="sd">        Mostly a useful shortcut/hook.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If an user does not have at least view permissions, he won&#39;t be able</span>
        <span class="c1"># to see the resource at all.</span>
        <span class="n">filtered_objects_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]:</span>
                <span class="n">filtered_objects_ids</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s2">&quot;view_resourcebase&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">get_self_resource</span><span class="p">())</span>
                <span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;objects&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">filtered_objects_ids</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_objects</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">filtered_objects_ids</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_objects</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">]))</span>

            <span class="c1"># give geonode version</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;geonode_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_version</span><span class="p">()</span>

        <span class="n">desired_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_format</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">serialized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">desired_format</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response_class</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">build_content_type</span><span class="p">(</span><span class="n">desired_format</span><span class="p">),</span> <span class="o">**</span><span class="n">response_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="CommonModelApi.prepend_urls">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.prepend_urls">[docs]</a>
    <span class="k">def</span> <span class="nf">prepend_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">HAYSTACK_SEARCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">url</span><span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;^(?P&lt;resource_name&gt;</span><span class="si">{}</span><span class="s2">)/search</span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">resource_name</span><span class="p">,</span> <span class="n">trailing_slash</span><span class="p">()),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wrap_view</span><span class="p">(</span><span class="s2">&quot;get_search&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;api_get_search&quot;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="CommonModelApi.hydrate_title">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.CommonModelApi.hydrate_title">[docs]</a>
    <span class="k">def</span> <span class="nf">hydrate_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">bundle</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bundle</span></div>
</div>



<div class="viewcode-block" id="ResourceBaseResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource">[docs]</a>
<span class="k">class</span> <span class="nc">ResourceBaseResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ResourceBase api&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ResourceBaseResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="ResourceBaseResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="ResourceBaseResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">polymorphic_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ResourceBaseResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;base&quot;</span></div>

<div class="viewcode-block" id="ResourceBaseResource.Meta.excludes">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta.excludes">[docs]</a>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;csw_anytext&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata_xml&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ResourceBaseResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.ResourceBaseResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>
</div>
</div>



<div class="viewcode-block" id="FeaturedResourceBaseResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource">[docs]</a>
<span class="k">class</span> <span class="nc">FeaturedResourceBaseResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Only the featured resourcebases&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FeaturedResourceBaseResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="FeaturedResourceBaseResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="FeaturedResourceBaseResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">ResourceBase</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">featured</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeaturedResourceBaseResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;featured&quot;</span></div>

<div class="viewcode-block" id="FeaturedResourceBaseResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.FeaturedResourceBaseResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>
</div>
</div>



<div class="viewcode-block" id="LayerResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource">[docs]</a>
<span class="k">class</span> <span class="nc">LayerResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataset API&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LayerResource.links">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.links">[docs]</a>
    <span class="n">links</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ListField</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;links&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_in</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[])</span></div>

    <span class="k">if</span> <span class="n">check_ogc_backend</span><span class="p">(</span><span class="n">geoserver</span><span class="o">.</span><span class="n">BACKEND_PACKAGE</span><span class="p">):</span>
<div class="viewcode-block" id="LayerResource.default_style">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.default_style">[docs]</a>
        <span class="n">default_style</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;geonode.api.api.StyleResource&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;default_style&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

        <span class="n">styles</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s2">&quot;geonode.api.api.StyleResource&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;styles&quot;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_in</span><span class="o">=</span><span class="s2">&quot;detail&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LayerResource.build_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.build_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_bad_filters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_only</span> <span class="o">=</span> <span class="n">_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">_filters</span><span class="p">)</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata_only</span> <span class="k">else</span> <span class="n">metadata_only</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">orm_filters</span></div>


<div class="viewcode-block" id="LayerResource.format_objects">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.format_objects">[docs]</a>
    <span class="k">def</span> <span class="nf">format_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># convert the object to a dict using the standard values.</span>
            <span class="c1"># includes other values</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;alternate&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">formatted_obj</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
            <span class="n">full_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span> <span class="ow">or</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner__username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;category__gn_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">gn_description</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="c1"># provide style information</span>
            <span class="n">bundle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;default_style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_style</span><span class="o">.</span><span class="n">dehydrate</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">for_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Add resource uri</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;resource_uri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_uri</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dehydrate_ogc_links</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;site_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatted_obj</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span>

            <span class="c1"># Probe Remote Services</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;store_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dataset&quot;</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">):</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;store_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">subtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;tileStore&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;remote_service&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">remote_service</span><span class="p">:</span>
                        <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">remote_service</span><span class="o">.</span><span class="n">probe</span> <span class="o">==</span> <span class="mi">200</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;gtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dehydrate_gtype</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;processed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">instance_is_processed</span>
            <span class="c1"># put the object on the response stack</span>
            <span class="n">formatted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatted_objects</span></div>


<div class="viewcode-block" id="LayerResource._dehydrate_links">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource._dehydrate_links">[docs]</a>
    <span class="k">def</span> <span class="nf">_dehydrate_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dehydrate links field.&quot;&quot;&quot;</span>

        <span class="n">dehydrated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span>
        <span class="n">link_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;extension&quot;</span><span class="p">,</span> <span class="s2">&quot;link_type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;mime&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">]</span>

        <span class="n">links</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">link_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">link_types</span><span class="p">:</span>
            <span class="n">links</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">link_type__in</span><span class="o">=</span><span class="n">link_types</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lnk</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">formatted_link</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">lnk</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">link_fields</span><span class="p">)</span>
            <span class="n">dehydrated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_link</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dehydrated</span></div>


<div class="viewcode-block" id="LayerResource.dehydrate_links">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.dehydrate_links">[docs]</a>
    <span class="k">def</span> <span class="nf">dehydrate_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dehydrate_links</span><span class="p">(</span><span class="n">bundle</span><span class="p">)</span></div>


<div class="viewcode-block" id="LayerResource.dehydrate_ogc_links">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.dehydrate_ogc_links">[docs]</a>
    <span class="k">def</span> <span class="nf">dehydrate_ogc_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dehydrate_links</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;OGC:WMS&quot;</span><span class="p">,</span> <span class="s2">&quot;OGC:WFS&quot;</span><span class="p">,</span> <span class="s2">&quot;OGC:WCS&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="LayerResource.dehydrate_gtype">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.dehydrate_gtype">[docs]</a>
    <span class="k">def</span> <span class="nf">dehydrate_gtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">bundle</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">gtype</span></div>


<div class="viewcode-block" id="LayerResource.build_bundle">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.build_bundle">[docs]</a>
    <span class="k">def</span> <span class="nf">build_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override build_bundle method to add additional info.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">object_class</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_object</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Bundle</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="LayerResource.populate_object">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.populate_object">[docs]</a>
    <span class="k">def</span> <span class="nf">populate_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate results with necessary fields</span>

<span class="sd">        :param obj: Dataset obj</span>
<span class="sd">        :type obj: Dataset</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span></div>


    <span class="c1"># copy parent attribute before modifying</span>
<div class="viewcode-block" id="LayerResource.VALUES">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.VALUES">[docs]</a>
    <span class="n">VALUES</span> <span class="o">=</span> <span class="n">CommonModelApi</span><span class="o">.</span><span class="n">VALUES</span><span class="p">[:]</span></div>

    <span class="n">VALUES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;typename&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LayerResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="LayerResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="LayerResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LayerResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;datasets&quot;</span></div>

<div class="viewcode-block" id="LayerResource.Meta.detail_uri_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.detail_uri_name">[docs]</a>
        <span class="n">detail_uri_name</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span></div>

<div class="viewcode-block" id="LayerResource.Meta.include_resource_uri">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.include_resource_uri">[docs]</a>
        <span class="n">include_resource_uri</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="LayerResource.Meta.allowed_methods">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.allowed_methods">[docs]</a>
        <span class="n">allowed_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;patch&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="LayerResource.Meta.excludes">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.excludes">[docs]</a>
        <span class="n">excludes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;csw_anytext&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata_xml&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="LayerResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="LayerResource.Meta.filtering">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.LayerResource.Meta.filtering">[docs]</a>
        <span class="n">filtering</span> <span class="o">=</span> <span class="n">CommonMetaApi</span><span class="o">.</span><span class="n">filtering</span></div>

        <span class="c1"># Allow filtering using ID</span>
        <span class="n">filtering</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span> <span class="s2">&quot;alternate&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">,</span> <span class="s2">&quot;metadata_only&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">})</span></div>
</div>



<div class="viewcode-block" id="MapResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource">[docs]</a>
<span class="k">class</span> <span class="nc">MapResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maps API&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MapResource.build_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.build_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_bad_filters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_only</span> <span class="o">=</span> <span class="n">_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">_filters</span><span class="p">)</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata_only</span> <span class="k">else</span> <span class="n">metadata_only</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">orm_filters</span></div>


<div class="viewcode-block" id="MapResource.format_objects">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.format_objects">[docs]</a>
    <span class="k">def</span> <span class="nf">format_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the objects and provides reference to list of layers in map</span>
<span class="sd">        resources.</span>

<span class="sd">        :param objects: Map objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># convert the object to a dict using the standard values.</span>
            <span class="n">formatted_obj</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
            <span class="n">full_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span> <span class="ow">or</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner__username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;category__gn_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">gn_description</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="s2">&quot;site_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatted_obj</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span>

            <span class="c1"># Probe Remote Services</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;store_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># get map layers</span>
            <span class="n">map_datasets</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">maplayers</span>
            <span class="n">formatted_datasets</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">map_dataset_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ows_url&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">map_datasets</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
                <span class="n">formatted_map_dataset</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">map_dataset_fields</span><span class="p">)</span>
                <span class="n">formatted_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_map_dataset</span><span class="p">)</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatted_datasets</span>

            <span class="n">formatted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatted_objects</span></div>


<div class="viewcode-block" id="MapResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="MapResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="MapResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MapResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;maps&quot;</span></div>

<div class="viewcode-block" id="MapResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.MapResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>
</div>
</div>



<div class="viewcode-block" id="GeoAppResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource">[docs]</a>
<span class="k">class</span> <span class="nc">GeoAppResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoApps API&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GeoAppResource.format_objects">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.format_objects">[docs]</a>
    <span class="k">def</span> <span class="nf">format_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the objects and provides reference to list of layers in GeoApp</span>
<span class="sd">        resources.</span>

<span class="sd">        :param objects: GeoApp objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># convert the object to a dict using the standard values.</span>
            <span class="n">formatted_obj</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
            <span class="n">full_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span> <span class="ow">or</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner__username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;category__gn_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">gn_description</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="s2">&quot;site_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatted_obj</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span>

            <span class="c1"># Probe Remote Services</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;store_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;geoapp&quot;</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">formatted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatted_objects</span></div>


<div class="viewcode-block" id="GeoAppResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="GeoAppResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="GeoAppResource.Meta.filtering">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta.filtering">[docs]</a>
        <span class="n">filtering</span> <span class="o">=</span> <span class="n">CommonMetaApi</span><span class="o">.</span><span class="n">filtering</span></div>

        <span class="n">filtering</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;app_type&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">})</span>
<div class="viewcode-block" id="GeoAppResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">GeoApp</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoAppResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;geoapps&quot;</span></div>

<div class="viewcode-block" id="GeoAppResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.GeoAppResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>
</div>
</div>



<div class="viewcode-block" id="DocumentResource">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource">[docs]</a>
<span class="k">class</span> <span class="nc">DocumentResource</span><span class="p">(</span><span class="n">CommonModelApi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Documents API&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DocumentResource.build_filters">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.build_filters">[docs]</a>
    <span class="k">def</span> <span class="nf">build_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_bad_filters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata_only</span> <span class="o">=</span> <span class="n">_filters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">orm_filters</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_filters</span><span class="p">(</span><span class="n">_filters</span><span class="p">)</span>
        <span class="n">orm_filters</span><span class="p">[</span><span class="s2">&quot;metadata_only&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">metadata_only</span> <span class="k">else</span> <span class="n">metadata_only</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">orm_filters</span></div>


<div class="viewcode-block" id="DocumentResource.format_objects">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.format_objects">[docs]</a>
    <span class="k">def</span> <span class="nf">format_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formats the objects and provides reference to list of layers in map</span>
<span class="sd">        resources.</span>

<span class="sd">        :param objects: Map objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formatted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
            <span class="c1"># convert the object to a dict using the standard values.</span>
            <span class="n">formatted_obj</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VALUES</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_username</span><span class="p">()</span>
            <span class="n">full_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">get_full_name</span><span class="p">()</span> <span class="ow">or</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner__username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;owner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;category__gn_description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">gn_description</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">GroupProfile</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;group_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">group</span>

            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">keywords</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;regions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">regions</span> <span class="k">else</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="s2">&quot;site_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">formatted_obj</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;site_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">SITEURL</span>

            <span class="c1"># Probe Remote Services</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;store_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dataset&quot;</span>
            <span class="n">formatted_obj</span><span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">formatted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatted_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatted_objects</span></div>


<div class="viewcode-block" id="DocumentResource.Meta">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta">[docs]</a>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">CommonMetaApi</span><span class="p">):</span>
<div class="viewcode-block" id="DocumentResource.Meta.paginator_class">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta.paginator_class">[docs]</a>
        <span class="n">paginator_class</span> <span class="o">=</span> <span class="n">CrossSiteXHRPaginator</span></div>

<div class="viewcode-block" id="DocumentResource.Meta.filtering">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta.filtering">[docs]</a>
        <span class="n">filtering</span> <span class="o">=</span> <span class="n">CommonMetaApi</span><span class="o">.</span><span class="n">filtering</span></div>

        <span class="n">filtering</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="n">ALL</span><span class="p">})</span>
<div class="viewcode-block" id="DocumentResource.Meta.queryset">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta.queryset">[docs]</a>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-date&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DocumentResource.Meta.resource_name">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta.resource_name">[docs]</a>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;documents&quot;</span></div>

<div class="viewcode-block" id="DocumentResource.Meta.authentication">
<a class="viewcode-back" href="../../../autoapi/geonode/api/resourcebase_api/index.html#geonode.api.resourcebase_api.DocumentResource.Meta.authentication">[docs]</a>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">MultiAuthentication</span><span class="p">(</span>
            <span class="n">SessionAuthentication</span><span class="p">(),</span> <span class="n">OAuthAuthentication</span><span class="p">(),</span> <span class="n">GeonodeApiKeyAuthentication</span><span class="p">()</span>
        <span class="p">)</span></div>
</div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kan Territory &amp; IT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>